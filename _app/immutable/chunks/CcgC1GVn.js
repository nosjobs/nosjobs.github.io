var So=Object.defineProperty;var _o=(e,t,n)=>t in e?So(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var B=(e,t,n)=>_o(e,typeof t!="symbol"?t+"":t,n);import{aK as Bo,aL as Io,aM as To,C as Dn,aN as Lo,aO as ko}from"./B8AwEteH.js";import{g as Ro}from"./CByCw1PR.js";const $o=Symbol("is custom element"),Uo=Symbol("is html");function Al(e){if(Dn){var t=!1,n=()=>{if(!t){if(t=!0,e.hasAttribute("value")){var r=e.value;An(e,"value",null),e.value=r}if(e.hasAttribute("checked")){var o=e.checked;An(e,"checked",null),e.checked=o}}};e.__on_r=n,ko(n),Ro()}}function An(e,t,n,r){var o=No(e);Dn&&(o[t]=e.getAttribute(t),t==="src"||t==="srcset"||t==="href"&&e.nodeName==="LINK")||o[t]!==(o[t]=n)&&(t==="loading"&&(e[Bo]=n),n==null?e.removeAttribute(t):typeof n!="string"&&Oo(e).includes(t)?e[t]=n:e.setAttribute(t,n))}function No(e){return e.__attributes??(e.__attributes={[$o]:e.nodeName.includes("-"),[Uo]:e.namespaceURI===Io})}var Sn=new Map;function Oo(e){var t=Sn.get(e.nodeName);if(t)return t;Sn.set(e.nodeName,t=[]);for(var n,r=e,o=Element.prototype;o!==r;){n=Lo(r);for(var s in n)n[s].set&&t.push(s);r=To(r)}return t}function _n(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`Wrong positive integer: ${e}`)}function zn(e,...t){if(!(e instanceof Uint8Array))throw new Error("Expected Uint8Array");if(t.length>0&&!t.includes(e.length))throw new Error(`Expected Uint8Array of length ${t}, not of length=${e.length}`)}function Co(e){if(typeof e!="function"||typeof e.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");_n(e.outputLen),_n(e.blockLen)}function Fe(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function Ho(e,t){zn(e);const n=t.outputLen;if(e.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}const wt=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Vn=e=>e instanceof Uint8Array,bt=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),ee=(e,t)=>e<<32-t|e>>>t,Po=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!Po)throw new Error("Non little-endian hardware is not supported");function Mo(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function qt(e){if(typeof e=="string"&&(e=Mo(e)),!Vn(e))throw new Error(`expected Uint8Array, got ${typeof e}`);return e}function qo(...e){const t=new Uint8Array(e.reduce((r,o)=>r+o.length,0));let n=0;return e.forEach(r=>{if(!Vn(r))throw new Error("Uint8Array expected");t.set(r,n),n+=r.length}),t}let Kn=class{clone(){return this._cloneInto()}};function Wo(e){const t=r=>e().update(qt(r)).digest(),n=e();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>e(),t}function Zn(e=32){if(wt&&typeof wt.getRandomValues=="function")return wt.getRandomValues(new Uint8Array(e));throw new Error("crypto.getRandomValues must be defined")}function jo(e,t,n,r){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,n,r);const o=BigInt(32),s=BigInt(4294967295),i=Number(n>>o&s),c=Number(n&s),a=r?4:0,u=r?0:4;e.setUint32(t+a,i,r),e.setUint32(t+u,c,r)}let Do=class extends Kn{constructor(t,n,r,o){super(),this.blockLen=t,this.outputLen=n,this.padOffset=r,this.isLE=o,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=bt(this.buffer)}update(t){Fe(this);const{view:n,buffer:r,blockLen:o}=this;t=qt(t);const s=t.length;for(let i=0;i<s;){const c=Math.min(o-this.pos,s-i);if(c===o){const a=bt(t);for(;o<=s-i;i+=o)this.process(a,i);continue}r.set(t.subarray(i,i+c),this.pos),this.pos+=c,i+=c,this.pos===o&&(this.process(n,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){Fe(this),Ho(t,this),this.finished=!0;const{buffer:n,view:r,blockLen:o,isLE:s}=this;let{pos:i}=this;n[i++]=128,this.buffer.subarray(i).fill(0),this.padOffset>o-i&&(this.process(r,0),i=0);for(let l=i;l<o;l++)n[l]=0;jo(r,o-8,BigInt(this.length*8),s),this.process(r,0);const c=bt(t),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const u=a/4,f=this.get();if(u>f.length)throw new Error("_sha2: outputLen bigger than state");for(let l=0;l<u;l++)c.setUint32(4*l,f[l],s)}digest(){const{buffer:t,outputLen:n}=this;this.digestInto(t);const r=t.slice(0,n);return this.destroy(),r}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:n,buffer:r,length:o,finished:s,destroyed:i,pos:c}=this;return t.length=o,t.pos=c,t.finished=s,t.destroyed=i,o%n&&t.buffer.set(r),t}};const zo=(e,t,n)=>e&t^~e&n,Vo=(e,t,n)=>e&t^e&n^t&n,Ko=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),pe=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),ge=new Uint32Array(64);let Zo=class extends Do{constructor(){super(64,32,8,!1),this.A=pe[0]|0,this.B=pe[1]|0,this.C=pe[2]|0,this.D=pe[3]|0,this.E=pe[4]|0,this.F=pe[5]|0,this.G=pe[6]|0,this.H=pe[7]|0}get(){const{A:t,B:n,C:r,D:o,E:s,F:i,G:c,H:a}=this;return[t,n,r,o,s,i,c,a]}set(t,n,r,o,s,i,c,a){this.A=t|0,this.B=n|0,this.C=r|0,this.D=o|0,this.E=s|0,this.F=i|0,this.G=c|0,this.H=a|0}process(t,n){for(let l=0;l<16;l++,n+=4)ge[l]=t.getUint32(n,!1);for(let l=16;l<64;l++){const h=ge[l-15],g=ge[l-2],y=ee(h,7)^ee(h,18)^h>>>3,d=ee(g,17)^ee(g,19)^g>>>10;ge[l]=d+ge[l-7]+y+ge[l-16]|0}let{A:r,B:o,C:s,D:i,E:c,F:a,G:u,H:f}=this;for(let l=0;l<64;l++){const h=ee(c,6)^ee(c,11)^ee(c,25),g=f+h+zo(c,a,u)+Ko[l]+ge[l]|0,d=(ee(r,2)^ee(r,13)^ee(r,22))+Vo(r,o,s)|0;f=u,u=a,a=c,c=i+g|0,i=s,s=o,o=r,r=g+d|0}r=r+this.A|0,o=o+this.B|0,s=s+this.C|0,i=i+this.D|0,c=c+this.E|0,a=a+this.F|0,u=u+this.G|0,f=f+this.H|0,this.set(r,o,s,i,c,a,u,f)}roundClean(){ge.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};const Tt=Wo(()=>new Zo);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Fn=BigInt(0),et=BigInt(1),Fo=BigInt(2),tt=e=>e instanceof Uint8Array,Go=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function Ue(e){if(!tt(e))throw new Error("Uint8Array expected");let t="";for(let n=0;n<e.length;n++)t+=Go[e[n]];return t}function Gn(e){const t=e.toString(16);return t.length&1?`0${t}`:t}function Wt(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);return BigInt(e===""?"0":`0x${e}`)}function Ne(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);const t=e.length;if(t%2)throw new Error("padded hex string expected, got unpadded hex of length "+t);const n=new Uint8Array(t/2);for(let r=0;r<n.length;r++){const o=r*2,s=e.slice(o,o+2),i=Number.parseInt(s,16);if(Number.isNaN(i)||i<0)throw new Error("Invalid byte sequence");n[r]=i}return n}function F(e){return Wt(Ue(e))}function jt(e){if(!tt(e))throw new Error("Uint8Array expected");return Wt(Ue(Uint8Array.from(e).reverse()))}function ve(e,t){return Ne(e.toString(16).padStart(t*2,"0"))}function Dt(e,t){return ve(e,t).reverse()}function Jo(e){return Ne(Gn(e))}function V(e,t,n){let r;if(typeof t=="string")try{r=Ne(t)}catch(s){throw new Error(`${e} must be valid hex string, got "${t}". Cause: ${s}`)}else if(tt(t))r=Uint8Array.from(t);else throw new Error(`${e} must be hex string or Uint8Array`);const o=r.length;if(typeof n=="number"&&o!==n)throw new Error(`${e} expected ${n} bytes, got ${o}`);return r}function Ie(...e){const t=new Uint8Array(e.reduce((r,o)=>r+o.length,0));let n=0;return e.forEach(r=>{if(!tt(r))throw new Error("Uint8Array expected");t.set(r,n),n+=r.length}),t}function Yo(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function Xo(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function Qo(e){let t;for(t=0;e>Fn;e>>=et,t+=1);return t}function es(e,t){return e>>BigInt(t)&et}const ts=(e,t,n)=>e|(n?et:Fn)<<BigInt(t),zt=e=>(Fo<<BigInt(e-1))-et,Et=e=>new Uint8Array(e),Bn=e=>Uint8Array.from(e);function Jn(e,t,n){if(typeof e!="number"||e<2)throw new Error("hashLen must be a number");if(typeof t!="number"||t<2)throw new Error("qByteLen must be a number");if(typeof n!="function")throw new Error("hmacFn must be a function");let r=Et(e),o=Et(e),s=0;const i=()=>{r.fill(1),o.fill(0),s=0},c=(...l)=>n(o,r,...l),a=(l=Et())=>{o=c(Bn([0]),l),r=c(),l.length!==0&&(o=c(Bn([1]),l),r=c())},u=()=>{if(s++>=1e3)throw new Error("drbg: tried 1000 values");let l=0;const h=[];for(;l<t;){r=c();const g=r.slice();h.push(g),l+=r.length}return Ie(...h)};return(l,h)=>{i(),a(l);let g;for(;!(g=h(u()));)a();return i(),g}}const ns={bigint:e=>typeof e=="bigint",function:e=>typeof e=="function",boolean:e=>typeof e=="boolean",string:e=>typeof e=="string",stringOrUint8Array:e=>typeof e=="string"||e instanceof Uint8Array,isSafeInteger:e=>Number.isSafeInteger(e),array:e=>Array.isArray(e),field:(e,t)=>t.Fp.isValid(e),hash:e=>typeof e=="function"&&Number.isSafeInteger(e.outputLen)};function Ve(e,t,n={}){const r=(o,s,i)=>{const c=ns[s];if(typeof c!="function")throw new Error(`Invalid validator "${s}", expected function`);const a=e[o];if(!(i&&a===void 0)&&!c(a,e))throw new Error(`Invalid param ${String(o)}=${a} (${typeof a}), expected ${s}`)};for(const[o,s]of Object.entries(t))r(o,s,!1);for(const[o,s]of Object.entries(n))r(o,s,!0);return e}const rs=Object.freeze(Object.defineProperty({__proto__:null,bitGet:es,bitLen:Qo,bitMask:zt,bitSet:ts,bytesToHex:Ue,bytesToNumberBE:F,bytesToNumberLE:jt,concatBytes:Ie,createHmacDrbg:Jn,ensureBytes:V,equalBytes:Yo,hexToBytes:Ne,hexToNumber:Wt,numberToBytesBE:ve,numberToBytesLE:Dt,numberToHexUnpadded:Gn,numberToVarBytesBE:Jo,utf8ToBytes:Xo,validateObject:Ve},Symbol.toStringTag,{value:"Module"}));/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const D=BigInt(0),j=BigInt(1),Se=BigInt(2),os=BigInt(3),Lt=BigInt(4),In=BigInt(5),Tn=BigInt(8);BigInt(9);BigInt(16);function z(e,t){const n=e%t;return n>=D?n:t+n}function ss(e,t,n){if(n<=D||t<D)throw new Error("Expected power/modulo > 0");if(n===j)return D;let r=j;for(;t>D;)t&j&&(r=r*e%n),e=e*e%n,t>>=j;return r}function G(e,t,n){let r=e;for(;t-- >D;)r*=r,r%=n;return r}function kt(e,t){if(e===D||t<=D)throw new Error(`invert: expected positive integers, got n=${e} mod=${t}`);let n=z(e,t),r=t,o=D,s=j;for(;n!==D;){const c=r/n,a=r%n,u=o-s*c;r=n,n=a,o=s,s=u}if(r!==j)throw new Error("invert: does not exist");return z(o,t)}function is(e){const t=(e-j)/Se;let n,r,o;for(n=e-j,r=0;n%Se===D;n/=Se,r++);for(o=Se;o<e&&ss(o,t,e)!==e-j;o++);if(r===1){const i=(e+j)/Lt;return function(a,u){const f=a.pow(u,i);if(!a.eql(a.sqr(f),u))throw new Error("Cannot find square root");return f}}const s=(n+j)/Se;return function(c,a){if(c.pow(a,t)===c.neg(c.ONE))throw new Error("Cannot find square root");let u=r,f=c.pow(c.mul(c.ONE,o),n),l=c.pow(a,s),h=c.pow(a,n);for(;!c.eql(h,c.ONE);){if(c.eql(h,c.ZERO))return c.ZERO;let g=1;for(let d=c.sqr(h);g<u&&!c.eql(d,c.ONE);g++)d=c.sqr(d);const y=c.pow(f,j<<BigInt(u-g-1));f=c.sqr(y),l=c.mul(l,y),h=c.mul(h,f),u=g}return l}}function as(e){if(e%Lt===os){const t=(e+j)/Lt;return function(r,o){const s=r.pow(o,t);if(!r.eql(r.sqr(s),o))throw new Error("Cannot find square root");return s}}if(e%Tn===In){const t=(e-In)/Tn;return function(r,o){const s=r.mul(o,Se),i=r.pow(s,t),c=r.mul(o,i),a=r.mul(r.mul(c,Se),i),u=r.mul(c,r.sub(a,r.ONE));if(!r.eql(r.sqr(u),o))throw new Error("Cannot find square root");return u}}return is(e)}const cs=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function ls(e){const t={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},n=cs.reduce((r,o)=>(r[o]="function",r),t);return Ve(e,n)}function us(e,t,n){if(n<D)throw new Error("Expected power > 0");if(n===D)return e.ONE;if(n===j)return t;let r=e.ONE,o=t;for(;n>D;)n&j&&(r=e.mul(r,o)),o=e.sqr(o),n>>=j;return r}function fs(e,t){const n=new Array(t.length),r=t.reduce((s,i,c)=>e.is0(i)?s:(n[c]=s,e.mul(s,i)),e.ONE),o=e.inv(r);return t.reduceRight((s,i,c)=>e.is0(i)?s:(n[c]=e.mul(s,n[c]),e.mul(s,i)),o),n}function Yn(e,t){const n=t!==void 0?t:e.toString(2).length,r=Math.ceil(n/8);return{nBitLength:n,nByteLength:r}}function ds(e,t,n=!1,r={}){if(e<=D)throw new Error(`Expected Field ORDER > 0, got ${e}`);const{nBitLength:o,nByteLength:s}=Yn(e,t);if(s>2048)throw new Error("Field lengths over 2048 bytes are not supported");const i=as(e),c=Object.freeze({ORDER:e,BITS:o,BYTES:s,MASK:zt(o),ZERO:D,ONE:j,create:a=>z(a,e),isValid:a=>{if(typeof a!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof a}`);return D<=a&&a<e},is0:a=>a===D,isOdd:a=>(a&j)===j,neg:a=>z(-a,e),eql:(a,u)=>a===u,sqr:a=>z(a*a,e),add:(a,u)=>z(a+u,e),sub:(a,u)=>z(a-u,e),mul:(a,u)=>z(a*u,e),pow:(a,u)=>us(c,a,u),div:(a,u)=>z(a*kt(u,e),e),sqrN:a=>a*a,addN:(a,u)=>a+u,subN:(a,u)=>a-u,mulN:(a,u)=>a*u,inv:a=>kt(a,e),sqrt:r.sqrt||(a=>i(c,a)),invertBatch:a=>fs(c,a),cmov:(a,u,f)=>f?u:a,toBytes:a=>n?Dt(a,s):ve(a,s),fromBytes:a=>{if(a.length!==s)throw new Error(`Fp.fromBytes: expected ${s}, got ${a.length}`);return n?jt(a):F(a)}});return Object.freeze(c)}function Xn(e){if(typeof e!="bigint")throw new Error("field order must be bigint");const t=e.toString(2).length;return Math.ceil(t/8)}function Qn(e){const t=Xn(e);return t+Math.ceil(t/2)}function hs(e,t,n=!1){const r=e.length,o=Xn(t),s=Qn(t);if(r<16||r<s||r>1024)throw new Error(`expected ${s}-1024 bytes of input, got ${r}`);const i=n?F(e):jt(e),c=z(i,t-j)+j;return n?Dt(c,o):ve(c,o)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const ps=BigInt(0),vt=BigInt(1);function gs(e,t){const n=(o,s)=>{const i=s.negate();return o?i:s},r=o=>{const s=Math.ceil(t/o)+1,i=2**(o-1);return{windows:s,windowSize:i}};return{constTimeNegate:n,unsafeLadder(o,s){let i=e.ZERO,c=o;for(;s>ps;)s&vt&&(i=i.add(c)),c=c.double(),s>>=vt;return i},precomputeWindow(o,s){const{windows:i,windowSize:c}=r(s),a=[];let u=o,f=u;for(let l=0;l<i;l++){f=u,a.push(f);for(let h=1;h<c;h++)f=f.add(u),a.push(f);u=f.double()}return a},wNAF(o,s,i){const{windows:c,windowSize:a}=r(o);let u=e.ZERO,f=e.BASE;const l=BigInt(2**o-1),h=2**o,g=BigInt(o);for(let y=0;y<c;y++){const d=y*a;let p=Number(i&l);i>>=g,p>a&&(p-=h,i+=vt);const w=d,v=d+Math.abs(p)-1,S=y%2!==0,$=p<0;p===0?f=f.add(n(S,s[w])):u=u.add(n($,s[v]))}return{p:u,f}},wNAFCached(o,s,i,c){const a=o._WINDOW_SIZE||1;let u=s.get(o);return u||(u=this.precomputeWindow(o,a),a!==1&&s.set(o,c(u))),this.wNAF(a,u,i)}}}function er(e){return ls(e.Fp),Ve(e,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...Yn(e.n,e.nBitLength),...e,p:e.Fp.ORDER})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function ys(e){const t=er(e);Ve(t,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:n,Fp:r,a:o}=t;if(n){if(!r.eql(o,r.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof n!="object"||typeof n.beta!="bigint"||typeof n.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...t})}const{bytesToNumberBE:ws,hexToBytes:bs}=rs,Be={Err:class extends Error{constructor(t=""){super(t)}},_parseInt(e){const{Err:t}=Be;if(e.length<2||e[0]!==2)throw new t("Invalid signature integer tag");const n=e[1],r=e.subarray(2,n+2);if(!n||r.length!==n)throw new t("Invalid signature integer: wrong length");if(r[0]&128)throw new t("Invalid signature integer: negative");if(r[0]===0&&!(r[1]&128))throw new t("Invalid signature integer: unnecessary leading zero");return{d:ws(r),l:e.subarray(n+2)}},toSig(e){const{Err:t}=Be,n=typeof e=="string"?bs(e):e;if(!(n instanceof Uint8Array))throw new Error("ui8a expected");let r=n.length;if(r<2||n[0]!=48)throw new t("Invalid signature tag");if(n[1]!==r-2)throw new t("Invalid signature: incorrect length");const{d:o,l:s}=Be._parseInt(n.subarray(2)),{d:i,l:c}=Be._parseInt(s);if(c.length)throw new t("Invalid signature: left bytes after parsing");return{r:o,s:i}},hexFromSig(e){const t=u=>Number.parseInt(u[0],16)&8?"00"+u:u,n=u=>{const f=u.toString(16);return f.length&1?`0${f}`:f},r=t(n(e.s)),o=t(n(e.r)),s=r.length/2,i=o.length/2,c=n(s),a=n(i);return`30${n(i+s+4)}02${a}${o}02${c}${r}`}},se=BigInt(0),J=BigInt(1);BigInt(2);const Ln=BigInt(3);BigInt(4);function Es(e){const t=ys(e),{Fp:n}=t,r=t.toBytes||((y,d,p)=>{const w=d.toAffine();return Ie(Uint8Array.from([4]),n.toBytes(w.x),n.toBytes(w.y))}),o=t.fromBytes||(y=>{const d=y.subarray(1),p=n.fromBytes(d.subarray(0,n.BYTES)),w=n.fromBytes(d.subarray(n.BYTES,2*n.BYTES));return{x:p,y:w}});function s(y){const{a:d,b:p}=t,w=n.sqr(y),v=n.mul(w,y);return n.add(n.add(v,n.mul(y,d)),p)}if(!n.eql(n.sqr(t.Gy),s(t.Gx)))throw new Error("bad generator point: equation left != right");function i(y){return typeof y=="bigint"&&se<y&&y<t.n}function c(y){if(!i(y))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function a(y){const{allowedPrivateKeyLengths:d,nByteLength:p,wrapPrivateKey:w,n:v}=t;if(d&&typeof y!="bigint"){if(y instanceof Uint8Array&&(y=Ue(y)),typeof y!="string"||!d.includes(y.length))throw new Error("Invalid key");y=y.padStart(p*2,"0")}let S;try{S=typeof y=="bigint"?y:F(V("private key",y,p))}catch{throw new Error(`private key must be ${p} bytes, hex or bigint, not ${typeof y}`)}return w&&(S=z(S,v)),c(S),S}const u=new Map;function f(y){if(!(y instanceof l))throw new Error("ProjectivePoint expected")}class l{constructor(d,p,w){if(this.px=d,this.py=p,this.pz=w,d==null||!n.isValid(d))throw new Error("x required");if(p==null||!n.isValid(p))throw new Error("y required");if(w==null||!n.isValid(w))throw new Error("z required")}static fromAffine(d){const{x:p,y:w}=d||{};if(!d||!n.isValid(p)||!n.isValid(w))throw new Error("invalid affine point");if(d instanceof l)throw new Error("projective point not allowed");const v=S=>n.eql(S,n.ZERO);return v(p)&&v(w)?l.ZERO:new l(p,w,n.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(d){const p=n.invertBatch(d.map(w=>w.pz));return d.map((w,v)=>w.toAffine(p[v])).map(l.fromAffine)}static fromHex(d){const p=l.fromAffine(o(V("pointHex",d)));return p.assertValidity(),p}static fromPrivateKey(d){return l.BASE.multiply(a(d))}_setWindowSize(d){this._WINDOW_SIZE=d,u.delete(this)}assertValidity(){if(this.is0()){if(t.allowInfinityPoint&&!n.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:d,y:p}=this.toAffine();if(!n.isValid(d)||!n.isValid(p))throw new Error("bad point: x or y not FE");const w=n.sqr(p),v=s(d);if(!n.eql(w,v))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:d}=this.toAffine();if(n.isOdd)return!n.isOdd(d);throw new Error("Field doesn't support isOdd")}equals(d){f(d);const{px:p,py:w,pz:v}=this,{px:S,py:$,pz:L}=d,m=n.eql(n.mul(p,L),n.mul(S,v)),x=n.eql(n.mul(w,L),n.mul($,v));return m&&x}negate(){return new l(this.px,n.neg(this.py),this.pz)}double(){const{a:d,b:p}=t,w=n.mul(p,Ln),{px:v,py:S,pz:$}=this;let L=n.ZERO,m=n.ZERO,x=n.ZERO,A=n.mul(v,v),M=n.mul(S,S),R=n.mul($,$),I=n.mul(v,S);return I=n.add(I,I),x=n.mul(v,$),x=n.add(x,x),L=n.mul(d,x),m=n.mul(w,R),m=n.add(L,m),L=n.sub(M,m),m=n.add(M,m),m=n.mul(L,m),L=n.mul(I,L),x=n.mul(w,x),R=n.mul(d,R),I=n.sub(A,R),I=n.mul(d,I),I=n.add(I,x),x=n.add(A,A),A=n.add(x,A),A=n.add(A,R),A=n.mul(A,I),m=n.add(m,A),R=n.mul(S,$),R=n.add(R,R),A=n.mul(R,I),L=n.sub(L,A),x=n.mul(R,M),x=n.add(x,x),x=n.add(x,x),new l(L,m,x)}add(d){f(d);const{px:p,py:w,pz:v}=this,{px:S,py:$,pz:L}=d;let m=n.ZERO,x=n.ZERO,A=n.ZERO;const M=t.a,R=n.mul(t.b,Ln);let I=n.mul(p,S),C=n.mul(w,$),H=n.mul(v,L),W=n.add(p,w),b=n.add(S,$);W=n.mul(W,b),b=n.add(I,C),W=n.sub(W,b),b=n.add(p,v);let E=n.add(S,L);return b=n.mul(b,E),E=n.add(I,H),b=n.sub(b,E),E=n.add(w,v),m=n.add($,L),E=n.mul(E,m),m=n.add(C,H),E=n.sub(E,m),A=n.mul(M,b),m=n.mul(R,H),A=n.add(m,A),m=n.sub(C,A),A=n.add(C,A),x=n.mul(m,A),C=n.add(I,I),C=n.add(C,I),H=n.mul(M,H),b=n.mul(R,b),C=n.add(C,H),H=n.sub(I,H),H=n.mul(M,H),b=n.add(b,H),I=n.mul(C,b),x=n.add(x,I),I=n.mul(E,b),m=n.mul(W,m),m=n.sub(m,I),I=n.mul(W,C),A=n.mul(E,A),A=n.add(A,I),new l(m,x,A)}subtract(d){return this.add(d.negate())}is0(){return this.equals(l.ZERO)}wNAF(d){return g.wNAFCached(this,u,d,p=>{const w=n.invertBatch(p.map(v=>v.pz));return p.map((v,S)=>v.toAffine(w[S])).map(l.fromAffine)})}multiplyUnsafe(d){const p=l.ZERO;if(d===se)return p;if(c(d),d===J)return this;const{endo:w}=t;if(!w)return g.unsafeLadder(this,d);let{k1neg:v,k1:S,k2neg:$,k2:L}=w.splitScalar(d),m=p,x=p,A=this;for(;S>se||L>se;)S&J&&(m=m.add(A)),L&J&&(x=x.add(A)),A=A.double(),S>>=J,L>>=J;return v&&(m=m.negate()),$&&(x=x.negate()),x=new l(n.mul(x.px,w.beta),x.py,x.pz),m.add(x)}multiply(d){c(d);let p=d,w,v;const{endo:S}=t;if(S){const{k1neg:$,k1:L,k2neg:m,k2:x}=S.splitScalar(p);let{p:A,f:M}=this.wNAF(L),{p:R,f:I}=this.wNAF(x);A=g.constTimeNegate($,A),R=g.constTimeNegate(m,R),R=new l(n.mul(R.px,S.beta),R.py,R.pz),w=A.add(R),v=M.add(I)}else{const{p:$,f:L}=this.wNAF(p);w=$,v=L}return l.normalizeZ([w,v])[0]}multiplyAndAddUnsafe(d,p,w){const v=l.BASE,S=(L,m)=>m===se||m===J||!L.equals(v)?L.multiplyUnsafe(m):L.multiply(m),$=S(this,p).add(S(d,w));return $.is0()?void 0:$}toAffine(d){const{px:p,py:w,pz:v}=this,S=this.is0();d==null&&(d=S?n.ONE:n.inv(v));const $=n.mul(p,d),L=n.mul(w,d),m=n.mul(v,d);if(S)return{x:n.ZERO,y:n.ZERO};if(!n.eql(m,n.ONE))throw new Error("invZ was invalid");return{x:$,y:L}}isTorsionFree(){const{h:d,isTorsionFree:p}=t;if(d===J)return!0;if(p)return p(l,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:d,clearCofactor:p}=t;return d===J?this:p?p(l,this):this.multiplyUnsafe(t.h)}toRawBytes(d=!0){return this.assertValidity(),r(l,this,d)}toHex(d=!0){return Ue(this.toRawBytes(d))}}l.BASE=new l(t.Gx,t.Gy,n.ONE),l.ZERO=new l(n.ZERO,n.ONE,n.ZERO);const h=t.nBitLength,g=gs(l,t.endo?Math.ceil(h/2):h);return{CURVE:t,ProjectivePoint:l,normPrivateKeyToScalar:a,weierstrassEquation:s,isWithinCurveOrder:i}}function vs(e){const t=er(e);return Ve(t,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...t})}function ms(e){const t=vs(e),{Fp:n,n:r}=t,o=n.BYTES+1,s=2*n.BYTES+1;function i(b){return se<b&&b<n.ORDER}function c(b){return z(b,r)}function a(b){return kt(b,r)}const{ProjectivePoint:u,normPrivateKeyToScalar:f,weierstrassEquation:l,isWithinCurveOrder:h}=Es({...t,toBytes(b,E,_){const k=E.toAffine(),T=n.toBytes(k.x),U=Ie;return _?U(Uint8Array.from([E.hasEvenY()?2:3]),T):U(Uint8Array.from([4]),T,n.toBytes(k.y))},fromBytes(b){const E=b.length,_=b[0],k=b.subarray(1);if(E===o&&(_===2||_===3)){const T=F(k);if(!i(T))throw new Error("Point is not on curve");const U=l(T);let P=n.sqrt(U);const O=(P&J)===J;return(_&1)===1!==O&&(P=n.neg(P)),{x:T,y:P}}else if(E===s&&_===4){const T=n.fromBytes(k.subarray(0,n.BYTES)),U=n.fromBytes(k.subarray(n.BYTES,2*n.BYTES));return{x:T,y:U}}else throw new Error(`Point of length ${E} was invalid. Expected ${o} compressed bytes or ${s} uncompressed bytes`)}}),g=b=>Ue(ve(b,t.nByteLength));function y(b){const E=r>>J;return b>E}function d(b){return y(b)?c(-b):b}const p=(b,E,_)=>F(b.slice(E,_));class w{constructor(E,_,k){this.r=E,this.s=_,this.recovery=k,this.assertValidity()}static fromCompact(E){const _=t.nByteLength;return E=V("compactSignature",E,_*2),new w(p(E,0,_),p(E,_,2*_))}static fromDER(E){const{r:_,s:k}=Be.toSig(V("DER",E));return new w(_,k)}assertValidity(){if(!h(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!h(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(E){return new w(this.r,this.s,E)}recoverPublicKey(E){const{r:_,s:k,recovery:T}=this,U=x(V("msgHash",E));if(T==null||![0,1,2,3].includes(T))throw new Error("recovery id invalid");const P=T===2||T===3?_+t.n:_;if(P>=n.ORDER)throw new Error("recovery id 2 or 3 invalid");const O=(T&1)===0?"02":"03",Y=u.fromHex(O+g(P)),de=a(P),Te=c(-U*de),qe=c(k*de),he=u.BASE.multiplyAndAddUnsafe(Y,Te,qe);if(!he)throw new Error("point at infinify");return he.assertValidity(),he}hasHighS(){return y(this.s)}normalizeS(){return this.hasHighS()?new w(this.r,c(-this.s),this.recovery):this}toDERRawBytes(){return Ne(this.toDERHex())}toDERHex(){return Be.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return Ne(this.toCompactHex())}toCompactHex(){return g(this.r)+g(this.s)}}const v={isValidPrivateKey(b){try{return f(b),!0}catch{return!1}},normPrivateKeyToScalar:f,randomPrivateKey:()=>{const b=Qn(t.n);return hs(t.randomBytes(b),t.n)},precompute(b=8,E=u.BASE){return E._setWindowSize(b),E.multiply(BigInt(3)),E}};function S(b,E=!0){return u.fromPrivateKey(b).toRawBytes(E)}function $(b){const E=b instanceof Uint8Array,_=typeof b=="string",k=(E||_)&&b.length;return E?k===o||k===s:_?k===2*o||k===2*s:b instanceof u}function L(b,E,_=!0){if($(b))throw new Error("first arg must be private key");if(!$(E))throw new Error("second arg must be public key");return u.fromHex(E).multiply(f(b)).toRawBytes(_)}const m=t.bits2int||function(b){const E=F(b),_=b.length*8-t.nBitLength;return _>0?E>>BigInt(_):E},x=t.bits2int_modN||function(b){return c(m(b))},A=zt(t.nBitLength);function M(b){if(typeof b!="bigint")throw new Error("bigint expected");if(!(se<=b&&b<A))throw new Error(`bigint expected < 2^${t.nBitLength}`);return ve(b,t.nByteLength)}function R(b,E,_=I){if(["recovered","canonical"].some(xe=>xe in _))throw new Error("sign() legacy options not supported");const{hash:k,randomBytes:T}=t;let{lowS:U,prehash:P,extraEntropy:O}=_;U==null&&(U=!0),b=V("msgHash",b),P&&(b=V("prehashed msgHash",k(b)));const Y=x(b),de=f(E),Te=[M(de),M(Y)];if(O!=null){const xe=O===!0?T(n.BYTES):O;Te.push(V("extraEntropy",xe))}const qe=Ie(...Te),he=Y;function yt(xe){const Le=m(xe);if(!h(Le))return;const vn=a(Le),ke=u.BASE.multiply(Le).toAffine(),X=c(ke.x);if(X===se)return;const Re=c(vn*c(he+X*de));if(Re===se)return;let mn=(ke.x===X?0:2)|Number(ke.y&J),xn=Re;return U&&y(Re)&&(xn=d(Re),mn^=1),new w(X,xn,mn)}return{seed:qe,k2sig:yt}}const I={lowS:t.lowS,prehash:!1},C={lowS:t.lowS,prehash:!1};function H(b,E,_=I){const{seed:k,k2sig:T}=R(b,E,_),U=t;return Jn(U.hash.outputLen,U.nByteLength,U.hmac)(k,T)}u.BASE._setWindowSize(8);function W(b,E,_,k=C){var ke;const T=b;if(E=V("msgHash",E),_=V("publicKey",_),"strict"in k)throw new Error("options.strict was renamed to lowS");const{lowS:U,prehash:P}=k;let O,Y;try{if(typeof T=="string"||T instanceof Uint8Array)try{O=w.fromDER(T)}catch(X){if(!(X instanceof Be.Err))throw X;O=w.fromCompact(T)}else if(typeof T=="object"&&typeof T.r=="bigint"&&typeof T.s=="bigint"){const{r:X,s:Re}=T;O=new w(X,Re)}else throw new Error("PARSE");Y=u.fromHex(_)}catch(X){if(X.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(U&&O.hasHighS())return!1;P&&(E=t.hash(E));const{r:de,s:Te}=O,qe=x(E),he=a(Te),yt=c(qe*he),xe=c(de*he),Le=(ke=u.BASE.multiplyAndAddUnsafe(Y,yt,xe))==null?void 0:ke.toAffine();return Le?c(Le.x)===de:!1}return{CURVE:t,getPublicKey:S,getSharedSecret:L,sign:H,verify:W,ProjectivePoint:u,Signature:w,utils:v}}let tr=class extends Kn{constructor(t,n){super(),this.finished=!1,this.destroyed=!1,Co(t);const r=qt(n);if(this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const o=this.blockLen,s=new Uint8Array(o);s.set(r.length>o?t.create().update(r).digest():r);for(let i=0;i<s.length;i++)s[i]^=54;this.iHash.update(s),this.oHash=t.create();for(let i=0;i<s.length;i++)s[i]^=106;this.oHash.update(s),s.fill(0)}update(t){return Fe(this),this.iHash.update(t),this}digestInto(t){Fe(this),zn(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){const t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:r,finished:o,destroyed:s,blockLen:i,outputLen:c}=this;return t=t,t.finished=o,t.destroyed=s,t.blockLen=i,t.outputLen=c,t.oHash=n._cloneInto(t.oHash),t.iHash=r._cloneInto(t.iHash),t}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const nr=(e,t,n)=>new tr(e,t).update(n).digest();nr.create=(e,t)=>new tr(e,t);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function xs(e){return{hash:e,hmac:(t,...n)=>nr(e,t,qo(...n)),randomBytes:Zn}}function As(e,t){const n=r=>ms({...e,...xs(r)});return Object.freeze({...n(t),create:n})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const nt=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),Ge=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),rr=BigInt(1),Je=BigInt(2),kn=(e,t)=>(e+t/Je)/t;function or(e){const t=nt,n=BigInt(3),r=BigInt(6),o=BigInt(11),s=BigInt(22),i=BigInt(23),c=BigInt(44),a=BigInt(88),u=e*e*e%t,f=u*u*e%t,l=G(f,n,t)*f%t,h=G(l,n,t)*f%t,g=G(h,Je,t)*u%t,y=G(g,o,t)*g%t,d=G(y,s,t)*y%t,p=G(d,c,t)*d%t,w=G(p,a,t)*p%t,v=G(w,c,t)*d%t,S=G(v,n,t)*f%t,$=G(S,i,t)*y%t,L=G($,r,t)*u%t,m=G(L,Je,t);if(!Rt.eql(Rt.sqr(m),e))throw new Error("Cannot find square root");return m}const Rt=ds(nt,void 0,void 0,{sqrt:or}),He=As({a:BigInt(0),b:BigInt(7),Fp:Rt,n:Ge,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:e=>{const t=Ge,n=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),r=-rr*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),o=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=n,i=BigInt("0x100000000000000000000000000000000"),c=kn(s*e,t),a=kn(-r*e,t);let u=z(e-c*n-a*o,t),f=z(-c*r-a*s,t);const l=u>i,h=f>i;if(l&&(u=t-u),h&&(f=t-f),u>i||f>i)throw new Error("splitScalar: Endomorphism failed, k="+e);return{k1neg:l,k1:u,k2neg:h,k2:f}}}},Tt),rt=BigInt(0),sr=e=>typeof e=="bigint"&&rt<e&&e<nt,Ss=e=>typeof e=="bigint"&&rt<e&&e<Ge,Rn={};function Ye(e,...t){let n=Rn[e];if(n===void 0){const r=Tt(Uint8Array.from(e,o=>o.charCodeAt(0)));n=Ie(r,r),Rn[e]=n}return Tt(Ie(n,...t))}const Vt=e=>e.toRawBytes(!0).slice(1),$t=e=>ve(e,32),mt=e=>z(e,nt),De=e=>z(e,Ge),Kt=He.ProjectivePoint,_s=(e,t,n)=>Kt.BASE.multiplyAndAddUnsafe(e,t,n);function Ut(e){let t=He.utils.normPrivateKeyToScalar(e),n=Kt.fromPrivateKey(t);return{scalar:n.hasEvenY()?t:De(-t),bytes:Vt(n)}}function ir(e){if(!sr(e))throw new Error("bad x: need 0 < x < p");const t=mt(e*e),n=mt(t*e+BigInt(7));let r=or(n);r%Je!==rt&&(r=mt(-r));const o=new Kt(e,r,rr);return o.assertValidity(),o}function ar(...e){return De(F(Ye("BIP0340/challenge",...e)))}function Bs(e){return Ut(e).bytes}function Is(e,t,n=Zn(32)){const r=V("message",e),{bytes:o,scalar:s}=Ut(t),i=V("auxRand",n,32),c=$t(s^F(Ye("BIP0340/aux",i))),a=Ye("BIP0340/nonce",c,o,r),u=De(F(a));if(u===rt)throw new Error("sign failed: k is zero");const{bytes:f,scalar:l}=Ut(u),h=ar(f,o,r),g=new Uint8Array(64);if(g.set(f,0),g.set($t(De(l+h*s)),32),!cr(g,r,o))throw new Error("sign: Invalid signature produced");return g}function cr(e,t,n){const r=V("signature",e,64),o=V("message",t),s=V("publicKey",n,32);try{const i=ir(F(s)),c=F(r.subarray(0,32));if(!sr(c))return!1;const a=F(r.subarray(32,64));if(!Ss(a))return!1;const u=ar($t(c),Vt(i),o),f=_s(i,a,De(-u));return!(!f||!f.hasEvenY()||f.toAffine().x!==c)}catch{return!1}}const We={getPublicKey:Bs,sign:Is,verify:cr,utils:{randomPrivateKey:He.utils.randomPrivateKey,lift_x:ir,pointToBytes:Vt,numberToBytesBE:ve,bytesToNumberBE:F,taggedHash:Ye,mod:z}},xt=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Zt=e=>e instanceof Uint8Array,At=e=>new DataView(e.buffer,e.byteOffset,e.byteLength),te=(e,t)=>e<<32-t|e>>>t,Ts=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!Ts)throw new Error("Non little-endian hardware is not supported");const Ls=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function Z(e){if(!Zt(e))throw new Error("Uint8Array expected");let t="";for(let n=0;n<e.length;n++)t+=Ls[e[n]];return t}function Oe(e){if(typeof e!="string")throw new Error("hex string expected, got "+typeof e);const t=e.length;if(t%2)throw new Error("padded hex string expected, got unpadded hex of length "+t);const n=new Uint8Array(t/2);for(let r=0;r<n.length;r++){const o=r*2,s=e.slice(o,o+2),i=Number.parseInt(s,16);if(Number.isNaN(i)||i<0)throw new Error("Invalid byte sequence");n[r]=i}return n}function ks(e){if(typeof e!="string")throw new Error(`utf8ToBytes expected string, got ${typeof e}`);return new Uint8Array(new TextEncoder().encode(e))}function ze(e){if(typeof e=="string"&&(e=ks(e)),!Zt(e))throw new Error(`expected Uint8Array, got ${typeof e}`);return e}function ot(...e){const t=new Uint8Array(e.reduce((r,o)=>r+o.length,0));let n=0;return e.forEach(r=>{if(!Zt(r))throw new Error("Uint8Array expected");t.set(r,n),n+=r.length}),t}class lr{clone(){return this._cloneInto()}}function ur(e){const t=r=>e().update(ze(r)).digest(),n=e();return t.outputLen=n.outputLen,t.blockLen=n.blockLen,t.create=()=>e(),t}function fr(e=32){if(xt&&typeof xt.getRandomValues=="function")return xt.getRandomValues(new Uint8Array(e));throw new Error("crypto.getRandomValues must be defined")}function Nt(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`Wrong positive integer: ${e}`)}function Rs(e){if(typeof e!="boolean")throw new Error(`Expected boolean, not ${e}`)}function dr(e,...t){if(!(e instanceof Uint8Array))throw new Error("Expected Uint8Array");if(t.length>0&&!t.includes(e.length))throw new Error(`Expected Uint8Array of length ${t}, not of length=${e.length}`)}function $s(e){if(typeof e!="function"||typeof e.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Nt(e.outputLen),Nt(e.blockLen)}function Us(e,t=!0){if(e.destroyed)throw new Error("Hash instance has been destroyed");if(t&&e.finished)throw new Error("Hash#digest() has already been called")}function Ns(e,t){dr(e);const n=t.outputLen;if(e.length<n)throw new Error(`digestInto() expects output buffer of length at least ${n}`)}const ne={number:Nt,bool:Rs,bytes:dr,hash:$s,exists:Us,output:Ns};function Os(e,t,n,r){if(typeof e.setBigUint64=="function")return e.setBigUint64(t,n,r);const o=BigInt(32),s=BigInt(4294967295),i=Number(n>>o&s),c=Number(n&s),a=r?4:0,u=r?0:4;e.setUint32(t+a,i,r),e.setUint32(t+u,c,r)}class Cs extends lr{constructor(t,n,r,o){super(),this.blockLen=t,this.outputLen=n,this.padOffset=r,this.isLE=o,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=At(this.buffer)}update(t){ne.exists(this);const{view:n,buffer:r,blockLen:o}=this;t=ze(t);const s=t.length;for(let i=0;i<s;){const c=Math.min(o-this.pos,s-i);if(c===o){const a=At(t);for(;o<=s-i;i+=o)this.process(a,i);continue}r.set(t.subarray(i,i+c),this.pos),this.pos+=c,i+=c,this.pos===o&&(this.process(n,0),this.pos=0)}return this.length+=t.length,this.roundClean(),this}digestInto(t){ne.exists(this),ne.output(t,this),this.finished=!0;const{buffer:n,view:r,blockLen:o,isLE:s}=this;let{pos:i}=this;n[i++]=128,this.buffer.subarray(i).fill(0),this.padOffset>o-i&&(this.process(r,0),i=0);for(let l=i;l<o;l++)n[l]=0;Os(r,o-8,BigInt(this.length*8),s),this.process(r,0);const c=At(t),a=this.outputLen;if(a%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const u=a/4,f=this.get();if(u>f.length)throw new Error("_sha2: outputLen bigger than state");for(let l=0;l<u;l++)c.setUint32(4*l,f[l],s)}digest(){const{buffer:t,outputLen:n}=this;this.digestInto(t);const r=t.slice(0,n);return this.destroy(),r}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:n,buffer:r,length:o,finished:s,destroyed:i,pos:c}=this;return t.length=o,t.pos=c,t.finished=s,t.destroyed=i,o%n&&t.buffer.set(r),t}}const Hs=(e,t,n)=>e&t^~e&n,Ps=(e,t,n)=>e&t^e&n^t&n,Ms=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),ye=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),we=new Uint32Array(64);class hr extends Cs{constructor(){super(64,32,8,!1),this.A=ye[0]|0,this.B=ye[1]|0,this.C=ye[2]|0,this.D=ye[3]|0,this.E=ye[4]|0,this.F=ye[5]|0,this.G=ye[6]|0,this.H=ye[7]|0}get(){const{A:t,B:n,C:r,D:o,E:s,F:i,G:c,H:a}=this;return[t,n,r,o,s,i,c,a]}set(t,n,r,o,s,i,c,a){this.A=t|0,this.B=n|0,this.C=r|0,this.D=o|0,this.E=s|0,this.F=i|0,this.G=c|0,this.H=a|0}process(t,n){for(let l=0;l<16;l++,n+=4)we[l]=t.getUint32(n,!1);for(let l=16;l<64;l++){const h=we[l-15],g=we[l-2],y=te(h,7)^te(h,18)^h>>>3,d=te(g,17)^te(g,19)^g>>>10;we[l]=d+we[l-7]+y+we[l-16]|0}let{A:r,B:o,C:s,D:i,E:c,F:a,G:u,H:f}=this;for(let l=0;l<64;l++){const h=te(c,6)^te(c,11)^te(c,25),g=f+h+Hs(c,a,u)+Ms[l]+we[l]|0,d=(te(r,2)^te(r,13)^te(r,22))+Ps(r,o,s)|0;f=u,u=a,a=c,c=i+g|0,i=s,s=o,o=r,r=g+d|0}r=r+this.A|0,o=o+this.B|0,s=s+this.C|0,i=i+this.D|0,c=c+this.E|0,a=a+this.F|0,u=u+this.G|0,f=f+this.H|0,this.set(r,o,s,i,c,a,u,f)}roundClean(){we.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}class qs extends hr{constructor(){super(),this.A=-1056596264,this.B=914150663,this.C=812702999,this.D=-150054599,this.E=-4191439,this.F=1750603025,this.G=1694076839,this.H=-1090891868,this.outputLen=28}}const Pe=ur(()=>new hr);ur(()=>new qs);/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */function Me(e){if(!Number.isSafeInteger(e))throw new Error(`Wrong integer: ${e}`)}function le(...e){const t=(o,s)=>i=>o(s(i)),n=Array.from(e).reverse().reduce((o,s)=>o?t(o,s.encode):s.encode,void 0),r=e.reduce((o,s)=>o?t(o,s.decode):s.decode,void 0);return{encode:n,decode:r}}function ue(e){return{encode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="number")throw new Error("alphabet.encode input should be an array of numbers");return t.map(n=>{if(Me(n),n<0||n>=e.length)throw new Error(`Digit index outside alphabet: ${n} (alphabet: ${e.length})`);return e[n]})},decode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="string")throw new Error("alphabet.decode input should be array of strings");return t.map(n=>{if(typeof n!="string")throw new Error(`alphabet.decode: not string element=${n}`);const r=e.indexOf(n);if(r===-1)throw new Error(`Unknown letter: "${n}". Allowed: ${e}`);return r})}}}function fe(e=""){if(typeof e!="string")throw new Error("join separator should be string");return{encode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="string")throw new Error("join.encode input should be array of strings");for(let n of t)if(typeof n!="string")throw new Error(`join.encode: non-string input=${n}`);return t.join(e)},decode:t=>{if(typeof t!="string")throw new Error("join.decode input should be string");return t.split(e)}}}function st(e,t="="){if(Me(e),typeof t!="string")throw new Error("padding chr should be string");return{encode(n){if(!Array.isArray(n)||n.length&&typeof n[0]!="string")throw new Error("padding.encode input should be array of strings");for(let r of n)if(typeof r!="string")throw new Error(`padding.encode: non-string input=${r}`);for(;n.length*e%8;)n.push(t);return n},decode(n){if(!Array.isArray(n)||n.length&&typeof n[0]!="string")throw new Error("padding.encode input should be array of strings");for(let o of n)if(typeof o!="string")throw new Error(`padding.decode: non-string input=${o}`);let r=n.length;if(r*e%8)throw new Error("Invalid padding: string should have whole number of bytes");for(;r>0&&n[r-1]===t;r--)if(!((r-1)*e%8))throw new Error("Invalid padding: string has too much padding");return n.slice(0,r)}}}function pr(e){if(typeof e!="function")throw new Error("normalize fn should be function");return{encode:t=>t,decode:t=>e(t)}}function $n(e,t,n){if(t<2)throw new Error(`convertRadix: wrong from=${t}, base cannot be less than 2`);if(n<2)throw new Error(`convertRadix: wrong to=${n}, base cannot be less than 2`);if(!Array.isArray(e))throw new Error("convertRadix: data should be array");if(!e.length)return[];let r=0;const o=[],s=Array.from(e);for(s.forEach(i=>{if(Me(i),i<0||i>=t)throw new Error(`Wrong integer: ${i}`)});;){let i=0,c=!0;for(let a=r;a<s.length;a++){const u=s[a],f=t*i+u;if(!Number.isSafeInteger(f)||t*i/t!==i||f-u!==t*i)throw new Error("convertRadix: carry overflow");if(i=f%n,s[a]=Math.floor(f/n),!Number.isSafeInteger(s[a])||s[a]*n+i!==f)throw new Error("convertRadix: carry overflow");if(c)s[a]?c=!1:r=a;else continue}if(o.push(i),c)break}for(let i=0;i<e.length-1&&e[i]===0;i++)o.push(0);return o.reverse()}const gr=(e,t)=>t?gr(t,e%t):e,Xe=(e,t)=>e+(t-gr(e,t));function Ot(e,t,n,r){if(!Array.isArray(e))throw new Error("convertRadix2: data should be array");if(t<=0||t>32)throw new Error(`convertRadix2: wrong from=${t}`);if(n<=0||n>32)throw new Error(`convertRadix2: wrong to=${n}`);if(Xe(t,n)>32)throw new Error(`convertRadix2: carry overflow from=${t} to=${n} carryBits=${Xe(t,n)}`);let o=0,s=0;const i=2**n-1,c=[];for(const a of e){if(Me(a),a>=2**t)throw new Error(`convertRadix2: invalid data word=${a} from=${t}`);if(o=o<<t|a,s+t>32)throw new Error(`convertRadix2: carry overflow pos=${s} from=${t}`);for(s+=t;s>=n;s-=n)c.push((o>>s-n&i)>>>0);o&=2**s-1}if(o=o<<n-s&i,!r&&s>=t)throw new Error("Excess padding");if(!r&&o)throw new Error(`Non-zero padding: ${o}`);return r&&s>0&&c.push(o>>>0),c}function Ws(e){return Me(e),{encode:t=>{if(!(t instanceof Uint8Array))throw new Error("radix.encode input should be Uint8Array");return $n(Array.from(t),2**8,e)},decode:t=>{if(!Array.isArray(t)||t.length&&typeof t[0]!="number")throw new Error("radix.decode input should be array of strings");return Uint8Array.from($n(t,e,2**8))}}}function me(e,t=!1){if(Me(e),e<=0||e>32)throw new Error("radix2: bits should be in (0..32]");if(Xe(8,e)>32||Xe(e,8)>32)throw new Error("radix2: carry overflow");return{encode:n=>{if(!(n instanceof Uint8Array))throw new Error("radix2.encode input should be Uint8Array");return Ot(Array.from(n),8,e,!t)},decode:n=>{if(!Array.isArray(n)||n.length&&typeof n[0]!="number")throw new Error("radix2.decode input should be array of strings");return Uint8Array.from(Ot(n,e,8,t))}}}function Un(e){if(typeof e!="function")throw new Error("unsafeWrapper fn should be function");return function(...t){try{return e.apply(null,t)}catch{}}}const js=le(me(4),ue("0123456789ABCDEF"),fe("")),Ds=le(me(5),ue("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),st(5),fe(""));le(me(5),ue("0123456789ABCDEFGHIJKLMNOPQRSTUV"),st(5),fe(""));le(me(5),ue("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),fe(""),pr(e=>e.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1")));const ce=le(me(6),ue("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),st(6),fe("")),zs=le(me(6),ue("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),st(6),fe("")),Ft=e=>le(Ws(58),ue(e),fe("")),Ct=Ft("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz");Ft("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ");Ft("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");const Nn=[0,2,3,5,6,7,9,10,11],Vs={encode(e){let t="";for(let n=0;n<e.length;n+=8){const r=e.subarray(n,n+8);t+=Ct.encode(r).padStart(Nn[r.length],"1")}return t},decode(e){let t=[];for(let n=0;n<e.length;n+=11){const r=e.slice(n,n+11),o=Nn.indexOf(r.length),s=Ct.decode(r);for(let i=0;i<s.length-o;i++)if(s[i]!==0)throw new Error("base58xmr: wrong padding");t=t.concat(Array.from(s.slice(s.length-o)))}return Uint8Array.from(t)}},Ht=le(ue("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),fe("")),On=[996825010,642813549,513874426,1027748829,705979059];function je(e){const t=e>>25;let n=(e&33554431)<<5;for(let r=0;r<On.length;r++)(t>>r&1)===1&&(n^=On[r]);return n}function Cn(e,t,n=1){const r=e.length;let o=1;for(let s=0;s<r;s++){const i=e.charCodeAt(s);if(i<33||i>126)throw new Error(`Invalid prefix (${e})`);o=je(o)^i>>5}o=je(o);for(let s=0;s<r;s++)o=je(o)^e.charCodeAt(s)&31;for(let s of t)o=je(o)^s;for(let s=0;s<6;s++)o=je(o);return o^=n,Ht.encode(Ot([o%2**30],30,5,!1))}function yr(e){const t=e==="bech32"?1:734539939,n=me(5),r=n.decode,o=n.encode,s=Un(r);function i(f,l,h=90){if(typeof f!="string")throw new Error(`bech32.encode prefix should be string, not ${typeof f}`);if(!Array.isArray(l)||l.length&&typeof l[0]!="number")throw new Error(`bech32.encode words should be array of numbers, not ${typeof l}`);const g=f.length+7+l.length;if(h!==!1&&g>h)throw new TypeError(`Length ${g} exceeds limit ${h}`);return f=f.toLowerCase(),`${f}1${Ht.encode(l)}${Cn(f,l,t)}`}function c(f,l=90){if(typeof f!="string")throw new Error(`bech32.decode input should be string, not ${typeof f}`);if(f.length<8||l!==!1&&f.length>l)throw new TypeError(`Wrong string length: ${f.length} (${f}). Expected (8..${l})`);const h=f.toLowerCase();if(f!==h&&f!==f.toUpperCase())throw new Error("String must be lowercase or uppercase");f=h;const g=f.lastIndexOf("1");if(g===0||g===-1)throw new Error('Letter "1" must be present between prefix and data only');const y=f.slice(0,g),d=f.slice(g+1);if(d.length<6)throw new Error("Data must be at least 6 characters long");const p=Ht.decode(d).slice(0,-6),w=Cn(y,p,t);if(!d.endsWith(w))throw new Error(`Invalid checksum in ${f}: expected "${w}"`);return{prefix:y,words:p}}const a=Un(c);function u(f){const{prefix:l,words:h}=c(f,!1);return{prefix:l,words:h,bytes:r(h)}}return{encode:i,decode:c,decodeToBytes:u,decodeUnsafe:a,fromWords:r,fromWordsUnsafe:s,toWords:o}}const Ce=yr("bech32");yr("bech32m");const Ks={encode:e=>new TextDecoder().decode(e),decode:e=>new TextEncoder().encode(e)},Zs=le(me(4),ue("0123456789abcdef"),fe(""),pr(e=>{if(typeof e!="string"||e.length%2)throw new TypeError(`hex.decode: expected string, got ${typeof e} with length ${e.length}`);return e.toLowerCase()})),Fs={utf8:Ks,hex:Zs,base16:js,base32:Ds,base64:ce,base64url:zs,base58:Ct,base58xmr:Vs};`${Object.keys(Fs).join(", ")}`;function St(e){if(!Number.isSafeInteger(e)||e<0)throw new Error(`positive integer expected, not ${e}`)}function Hn(e){if(typeof e!="boolean")throw new Error(`boolean expected, not ${e}`)}function Gs(e){return e instanceof Uint8Array||e!=null&&typeof e=="object"&&e.constructor.name==="Uint8Array"}function ie(e,...t){if(!Gs(e))throw new Error("Uint8Array expected");if(t.length>0&&!t.includes(e.length))throw new Error(`Uint8Array expected of length ${t}, not of length=${e.length}`)}/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */const K=e=>new Uint32Array(e.buffer,e.byteOffset,Math.floor(e.byteLength/4)),Js=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!Js)throw new Error("Non little-endian hardware is not supported");function Ys(e,t){if(t==null||typeof t!="object")throw new Error("options must be defined");return Object.assign(e,t)}function Xs(e,t){if(e.length!==t.length)return!1;let n=0;for(let r=0;r<e.length;r++)n|=e[r]^t[r];return n===0}const Qs=(e,t)=>(Object.assign(t,e),t),Ee=16,ei=283;function Gt(e){return e<<1^ei&-(e>>7)}function $e(e,t){let n=0;for(;t>0;t>>=1)n^=e&-(t&1),e=Gt(e);return n}const Pt=(()=>{let e=new Uint8Array(256);for(let n=0,r=1;n<256;n++,r^=Gt(r))e[n]=r;const t=new Uint8Array(256);t[0]=99;for(let n=0;n<255;n++){let r=e[255-n];r|=r<<8,t[e[n]]=(r^r>>4^r>>5^r>>6^r>>7^99)&255}return t})(),ti=Pt.map((e,t)=>Pt.indexOf(t)),ni=e=>e<<24|e>>>8,_t=e=>e<<8|e>>>24;function wr(e,t){if(e.length!==256)throw new Error("Wrong sbox length");const n=new Uint32Array(256).map((u,f)=>t(e[f])),r=n.map(_t),o=r.map(_t),s=o.map(_t),i=new Uint32Array(256*256),c=new Uint32Array(256*256),a=new Uint16Array(256*256);for(let u=0;u<256;u++)for(let f=0;f<256;f++){const l=u*256+f;i[l]=n[u]^r[f],c[l]=o[u]^s[f],a[l]=e[u]<<8|e[f]}return{sbox:e,sbox2:a,T0:n,T1:r,T2:o,T3:s,T01:i,T23:c}}const Jt=wr(Pt,e=>$e(e,3)<<24|e<<16|e<<8|$e(e,2)),br=wr(ti,e=>$e(e,11)<<24|$e(e,13)<<16|$e(e,9)<<8|$e(e,14)),ri=(()=>{const e=new Uint8Array(16);for(let t=0,n=1;t<16;t++,n=Gt(n))e[t]=n;return e})();function Er(e){ie(e);const t=e.length;if(![16,24,32].includes(t))throw new Error(`aes: wrong key size: should be 16, 24 or 32, got: ${t}`);const{sbox2:n}=Jt,r=K(e),o=r.length,s=c=>re(n,c,c,c,c),i=new Uint32Array(t+28);i.set(r);for(let c=o;c<i.length;c++){let a=i[c-1];c%o===0?a=s(ni(a))^ri[c/o-1]:o>6&&c%o===4&&(a=s(a)),i[c]=i[c-o]^a}return i}function oi(e){const t=Er(e),n=t.slice(),r=t.length,{sbox2:o}=Jt,{T0:s,T1:i,T2:c,T3:a}=br;for(let u=0;u<r;u+=4)for(let f=0;f<4;f++)n[u+f]=t[r-u-4+f];t.fill(0);for(let u=4;u<r-4;u++){const f=n[u],l=re(o,f,f,f,f);n[u]=s[l&255]^i[l>>>8&255]^c[l>>>16&255]^a[l>>>24]}return n}function be(e,t,n,r,o,s){return e[n<<8&65280|r>>>8&255]^t[o>>>8&65280|s>>>24&255]}function re(e,t,n,r,o){return e[t&255|n&65280]|e[r>>>16&255|o>>>16&65280]<<16}function Pn(e,t,n,r,o){const{sbox2:s,T01:i,T23:c}=Jt;let a=0;t^=e[a++],n^=e[a++],r^=e[a++],o^=e[a++];const u=e.length/4-2;for(let y=0;y<u;y++){const d=e[a++]^be(i,c,t,n,r,o),p=e[a++]^be(i,c,n,r,o,t),w=e[a++]^be(i,c,r,o,t,n),v=e[a++]^be(i,c,o,t,n,r);t=d,n=p,r=w,o=v}const f=e[a++]^re(s,t,n,r,o),l=e[a++]^re(s,n,r,o,t),h=e[a++]^re(s,r,o,t,n),g=e[a++]^re(s,o,t,n,r);return{s0:f,s1:l,s2:h,s3:g}}function si(e,t,n,r,o){const{sbox2:s,T01:i,T23:c}=br;let a=0;t^=e[a++],n^=e[a++],r^=e[a++],o^=e[a++];const u=e.length/4-2;for(let y=0;y<u;y++){const d=e[a++]^be(i,c,t,o,r,n),p=e[a++]^be(i,c,n,t,o,r),w=e[a++]^be(i,c,r,n,t,o),v=e[a++]^be(i,c,o,r,n,t);t=d,n=p,r=w,o=v}const f=e[a++]^re(s,t,o,r,n),l=e[a++]^re(s,n,t,o,r),h=e[a++]^re(s,r,n,t,o),g=e[a++]^re(s,o,r,n,t);return{s0:f,s1:l,s2:h,s3:g}}function vr(e,t){if(!t)return new Uint8Array(e);if(ie(t),t.length<e)throw new Error(`aes: wrong destination length, expected at least ${e}, got: ${t.length}`);return t}function ii(e){if(ie(e),e.length%Ee!==0)throw new Error(`aes/(cbc-ecb).decrypt ciphertext should consist of blocks with size ${Ee}`)}function ai(e,t,n){let r=e.length;const o=r%Ee;if(!t&&o!==0)throw new Error("aec/(cbc-ecb): unpadded plaintext with disabled padding");const s=K(e);if(t){let a=Ee-o;a||(a=Ee),r=r+a}const i=vr(r,n),c=K(i);return{b:s,o:c,out:i}}function ci(e,t){if(!t)return e;const n=e.length;if(!n)throw new Error("aes/pcks5: empty ciphertext not allowed");const r=e[n-1];if(r<=0||r>16)throw new Error(`aes/pcks5: wrong padding byte: ${r}`);const o=e.subarray(0,-r);for(let s=0;s<r;s++)if(e[n-s-1]!==r)throw new Error("aes/pcks5: wrong padding");return o}function li(e){const t=new Uint8Array(16),n=K(t);t.set(e);const r=Ee-e.length;for(let o=Ee-r;o<Ee;o++)t[o]=r;return n}const mr=Qs({blockSize:16,nonceLength:16},function(t,n,r={}){ie(t),ie(n,16);const o=!r.disablePadding;return{encrypt:(s,i)=>{const c=Er(t),{b:a,o:u,out:f}=ai(s,o,i),l=K(n);let h=l[0],g=l[1],y=l[2],d=l[3],p=0;for(;p+4<=a.length;)h^=a[p+0],g^=a[p+1],y^=a[p+2],d^=a[p+3],{s0:h,s1:g,s2:y,s3:d}=Pn(c,h,g,y,d),u[p++]=h,u[p++]=g,u[p++]=y,u[p++]=d;if(o){const w=li(s.subarray(p*4));h^=w[0],g^=w[1],y^=w[2],d^=w[3],{s0:h,s1:g,s2:y,s3:d}=Pn(c,h,g,y,d),u[p++]=h,u[p++]=g,u[p++]=y,u[p++]=d}return c.fill(0),f},decrypt:(s,i)=>{ii(s);const c=oi(t),a=K(n),u=vr(s.length,i),f=K(s),l=K(u);let h=a[0],g=a[1],y=a[2],d=a[3];for(let p=0;p+4<=f.length;){const w=h,v=g,S=y,$=d;h=f[p+0],g=f[p+1],y=f[p+2],d=f[p+3];const{s0:L,s1:m,s2:x,s3:A}=si(c,h,g,y,d);l[p++]=L^w,l[p++]=m^v,l[p++]=x^S,l[p++]=A^$}return c.fill(0),ci(u,o)}}}),xr=e=>Uint8Array.from(e.split("").map(t=>t.charCodeAt(0))),ui=xr("expand 16-byte k"),fi=xr("expand 32-byte k"),di=K(ui),Ar=K(fi);Ar.slice();function N(e,t){return e<<t|e>>>32-t}function Mt(e){return e.byteOffset%4===0}const Ke=64,hi=16,Sr=2**32-1,Mn=new Uint32Array;function pi(e,t,n,r,o,s,i,c){const a=o.length,u=new Uint8Array(Ke),f=K(u),l=Mt(o)&&Mt(s),h=l?K(o):Mn,g=l?K(s):Mn;for(let y=0;y<a;i++){if(e(t,n,r,f,i,c),i>=Sr)throw new Error("arx: counter overflow");const d=Math.min(Ke,a-y);if(l&&d===Ke){const p=y/4;if(y%4!==0)throw new Error("arx: invalid block position");for(let w=0,v;w<hi;w++)v=p+w,g[v]=h[v]^f[w];y+=Ke;continue}for(let p=0,w;p<d;p++)w=y+p,s[w]=o[w]^u[p];y+=d}}function gi(e,t){const{allowShortKeys:n,extendNonceFn:r,counterLength:o,counterRight:s,rounds:i}=Ys({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},t);if(typeof e!="function")throw new Error("core must be a function");return St(o),St(i),Hn(s),Hn(n),(c,a,u,f,l=0)=>{ie(c),ie(a),ie(u);const h=u.length;if(f||(f=new Uint8Array(h)),ie(f),St(l),l<0||l>=Sr)throw new Error("arx: counter overflow");if(f.length<h)throw new Error(`arx: output (${f.length}) is shorter than data (${h})`);const g=[];let y=c.length,d,p;if(y===32)d=c.slice(),g.push(d),p=Ar;else if(y===16&&n)d=new Uint8Array(32),d.set(c),d.set(c,16),p=di,g.push(d);else throw new Error(`arx: invalid 32-byte key, got length=${y}`);Mt(a)||(a=a.slice(),g.push(a));const w=K(d);if(r){if(a.length!==24)throw new Error("arx: extended nonce must be 24 bytes");r(p,w,K(a.subarray(0,16)),w),a=a.subarray(16)}const v=16-o;if(v!==a.length)throw new Error(`arx: nonce must be ${v} or 16 bytes`);if(v!==12){const $=new Uint8Array(12);$.set(a,s?0:12-a.length),a=$,g.push(a)}const S=K(a);for(pi(e,p,w,S,u,f,l,i);g.length>0;)g.pop().fill(0);return f}}function yi(e,t,n,r,o,s=20){let i=e[0],c=e[1],a=e[2],u=e[3],f=t[0],l=t[1],h=t[2],g=t[3],y=t[4],d=t[5],p=t[6],w=t[7],v=o,S=n[0],$=n[1],L=n[2],m=i,x=c,A=a,M=u,R=f,I=l,C=h,H=g,W=y,b=d,E=p,_=w,k=v,T=S,U=$,P=L;for(let Y=0;Y<s;Y+=2)m=m+R|0,k=N(k^m,16),W=W+k|0,R=N(R^W,12),m=m+R|0,k=N(k^m,8),W=W+k|0,R=N(R^W,7),x=x+I|0,T=N(T^x,16),b=b+T|0,I=N(I^b,12),x=x+I|0,T=N(T^x,8),b=b+T|0,I=N(I^b,7),A=A+C|0,U=N(U^A,16),E=E+U|0,C=N(C^E,12),A=A+C|0,U=N(U^A,8),E=E+U|0,C=N(C^E,7),M=M+H|0,P=N(P^M,16),_=_+P|0,H=N(H^_,12),M=M+H|0,P=N(P^M,8),_=_+P|0,H=N(H^_,7),m=m+I|0,P=N(P^m,16),E=E+P|0,I=N(I^E,12),m=m+I|0,P=N(P^m,8),E=E+P|0,I=N(I^E,7),x=x+C|0,k=N(k^x,16),_=_+k|0,C=N(C^_,12),x=x+C|0,k=N(k^x,8),_=_+k|0,C=N(C^_,7),A=A+H|0,T=N(T^A,16),W=W+T|0,H=N(H^W,12),A=A+H|0,T=N(T^A,8),W=W+T|0,H=N(H^W,7),M=M+R|0,U=N(U^M,16),b=b+U|0,R=N(R^b,12),M=M+R|0,U=N(U^M,8),b=b+U|0,R=N(R^b,7);let O=0;r[O++]=i+m|0,r[O++]=c+x|0,r[O++]=a+A|0,r[O++]=u+M|0,r[O++]=f+R|0,r[O++]=l+I|0,r[O++]=h+C|0,r[O++]=g+H|0,r[O++]=y+W|0,r[O++]=d+b|0,r[O++]=p+E|0,r[O++]=w+_|0,r[O++]=v+k|0,r[O++]=S+T|0,r[O++]=$+U|0,r[O++]=L+P|0}const _r=gi(yi,{counterRight:!1,counterLength:4,allowShortKeys:!1});class Br extends lr{constructor(t,n){super(),this.finished=!1,this.destroyed=!1,ne.hash(t);const r=ze(n);if(this.iHash=t.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const o=this.blockLen,s=new Uint8Array(o);s.set(r.length>o?t.create().update(r).digest():r);for(let i=0;i<s.length;i++)s[i]^=54;this.iHash.update(s),this.oHash=t.create();for(let i=0;i<s.length;i++)s[i]^=106;this.oHash.update(s),s.fill(0)}update(t){return ne.exists(this),this.iHash.update(t),this}digestInto(t){ne.exists(this),ne.bytes(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){const t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));const{oHash:n,iHash:r,finished:o,destroyed:s,blockLen:i,outputLen:c}=this;return t=t,t.finished=o,t.destroyed=s,t.blockLen=i,t.outputLen=c,t.oHash=n._cloneInto(t.oHash),t.iHash=r._cloneInto(t.iHash),t}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const it=(e,t,n)=>new Br(e,t).update(n).digest();it.create=(e,t)=>new Br(e,t);function wi(e,t,n){return ne.hash(e),it(e,ze(n),ze(t))}const Bt=new Uint8Array([0]),qn=new Uint8Array;function bi(e,t,n,r=32){if(ne.hash(e),ne.number(r),r>255*e.outputLen)throw new Error("Length should be <= 255*HashLen");const o=Math.ceil(r/e.outputLen);n===void 0&&(n=qn);const s=new Uint8Array(o*e.outputLen),i=it.create(e,t),c=i._cloneInto(),a=new Uint8Array(i.outputLen);for(let u=0;u<o;u++)Bt[0]=u+1,c.update(u===0?qn:a).update(n).update(Bt).digestInto(a),s.set(a,e.outputLen*u),i._cloneInto(c);return i.destroy(),c.destroy(),a.fill(0),Bt.fill(0),s.slice(0,r)}var Ei=Object.defineProperty,q=(e,t)=>{for(var n in t)Ei(e,n,{get:t[n],enumerable:!0})},Ae=Symbol("verified"),vi=e=>e instanceof Object;function Yt(e){if(!vi(e)||typeof e.kind!="number"||typeof e.content!="string"||typeof e.created_at!="number"||typeof e.pubkey!="string"||!e.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(e.tags))return!1;for(let t=0;t<e.tags.length;t++){let n=e.tags[t];if(!Array.isArray(n))return!1;for(let r=0;r<n.length;r++)if(typeof n[r]!="string")return!1}return!0}var mi={};q(mi,{Queue:()=>Tr,QueueNode:()=>Ir,binarySearch:()=>Xt,insertEventIntoAscendingList:()=>Ai,insertEventIntoDescendingList:()=>xi,normalizeURL:()=>_e,utf8Decoder:()=>ae,utf8Encoder:()=>Q});var ae=new TextDecoder("utf-8"),Q=new TextEncoder;function _e(e){try{e.indexOf("://")===-1&&(e="wss://"+e);let t=new URL(e);return t.pathname=t.pathname.replace(/\/+/g,"/"),t.pathname.endsWith("/")&&(t.pathname=t.pathname.slice(0,-1)),(t.port==="80"&&t.protocol==="ws:"||t.port==="443"&&t.protocol==="wss:")&&(t.port=""),t.searchParams.sort(),t.hash="",t.toString()}catch{throw new Error(`Invalid URL: ${e}`)}}function xi(e,t){const[n,r]=Xt(e,o=>t.id===o.id?0:t.created_at===o.created_at?-1:o.created_at-t.created_at);return r||e.splice(n,0,t),e}function Ai(e,t){const[n,r]=Xt(e,o=>t.id===o.id?0:t.created_at===o.created_at?-1:t.created_at-o.created_at);return r||e.splice(n,0,t),e}function Xt(e,t){let n=0,r=e.length-1;for(;n<=r;){const o=Math.floor((n+r)/2),s=t(e[o]);if(s===0)return[o,!0];s<0?r=o-1:n=o+1}return[n,!1]}var Ir=class{constructor(e){B(this,"value");B(this,"next",null);B(this,"prev",null);this.value=e}},Tr=class{constructor(){B(this,"first");B(this,"last");this.first=null,this.last=null}enqueue(e){const t=new Ir(e);return this.last?this.last===this.first?(this.last=t,this.last.prev=this.first,this.first.next=t):(t.prev=this.last,this.last.next=t,this.last=t):(this.first=t,this.last=t),!0}dequeue(){if(!this.first)return null;if(this.first===this.last){const t=this.first;return this.first=null,this.last=null,t.value}const e=this.first;return this.first=e.next,this.first&&(this.first.prev=null),e.value}},Si=class{generateSecretKey(){return We.utils.randomPrivateKey()}getPublicKey(e){return Z(We.getPublicKey(e))}finalizeEvent(e,t){const n=e;return n.pubkey=Z(We.getPublicKey(t)),n.id=Ze(n),n.sig=Z(We.sign(Ze(n),t)),n[Ae]=!0,n}verifyEvent(e){if(typeof e[Ae]=="boolean")return e[Ae];const t=Ze(e);if(t!==e.id)return e[Ae]=!1,!1;try{const n=We.verify(e.sig,t,e.pubkey);return e[Ae]=n,n}catch{return e[Ae]=!1,!1}}};function _i(e){if(!Yt(e))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,e.pubkey,e.created_at,e.kind,e.tags,e.content])}function Ze(e){let t=Pe(Q.encode(_i(e)));return Z(t)}var at=new Si,Bi=at.generateSecretKey,Qt=at.getPublicKey,oe=at.finalizeEvent,ct=at.verifyEvent,Ii={};q(Ii,{Application:()=>Ia,BadgeAward:()=>Ci,BadgeDefinition:()=>va,BlockedRelaysList:()=>oa,BookmarkList:()=>ta,Bookmarksets:()=>wa,Calendar:()=>Na,CalendarEventRSVP:()=>Oa,ChannelCreation:()=>Nr,ChannelHideMessage:()=>Hr,ChannelMessage:()=>Cr,ChannelMetadata:()=>Or,ChannelMuteUser:()=>Pr,ClassifiedListing:()=>ka,ClientAuth:()=>qr,CommunitiesList:()=>na,CommunityDefinition:()=>Pa,CommunityPostApproval:()=>zi,Contacts:()=>Ui,CreateOrUpdateProduct:()=>Aa,CreateOrUpdateStall:()=>xa,Curationsets:()=>ba,Date:()=>$a,DirectMessageRelaysList:()=>ca,DraftClassifiedListing:()=>Ra,DraftLong:()=>_a,Emojisets:()=>Ba,EncryptedDirectMessage:()=>Ni,EventDeletion:()=>Oi,FileMetadata:()=>Pi,FileServerPreference:()=>la,Followsets:()=>pa,GenericRepost:()=>rn,Genericlists:()=>ga,GiftWrap:()=>Mr,HTTPAuth:()=>on,Handlerinformation:()=>Ha,Handlerrecommendation:()=>Ca,Highlights:()=>Yi,InterestsList:()=>ia,Interestsets:()=>ma,JobFeedback:()=>Zi,JobRequest:()=>Vi,JobResult:()=>Ki,Label:()=>Di,LightningPubRPC:()=>fa,LiveChatMessage:()=>Mi,LiveEvent:()=>Ta,LongFormArticle:()=>Sa,Metadata:()=>Ri,Mutelist:()=>Xi,NWCWalletInfo:()=>ua,NWCWalletRequest:()=>Wr,NWCWalletResponse:()=>da,NostrConnect:()=>ha,OpenTimestamps:()=>Hi,Pinlist:()=>Qi,PrivateDirectMessage:()=>Ur,ProblemTracker:()=>qi,ProfileBadges:()=>Ea,PublicChatsList:()=>ra,Reaction:()=>nn,RecommendRelay:()=>$i,RelayList:()=>ea,Relaysets:()=>ya,Report:()=>Wi,Reporting:()=>ji,Repost:()=>tn,Seal:()=>$r,SearchRelaysList:()=>sa,ShortTextNote:()=>Rr,Time:()=>Ua,UserEmojiList:()=>aa,UserStatuses:()=>La,Zap:()=>Ji,ZapGoal:()=>Fi,ZapRequest:()=>Gi,classifyKind:()=>Li,isAddressableKind:()=>lt,isEphemeralKind:()=>kr,isKind:()=>ki,isParameterizedReplaceableKind:()=>Ti,isRegularKind:()=>Lr,isReplaceableKind:()=>en});function Lr(e){return 1e3<=e&&e<1e4||[1,2,4,5,6,7,8,16,40,41,42,43,44].includes(e)}function en(e){return[0,3].includes(e)||1e4<=e&&e<2e4}function kr(e){return 2e4<=e&&e<3e4}function lt(e){return 3e4<=e&&e<4e4}var Ti=lt;function Li(e){return Lr(e)?"regular":en(e)?"replaceable":kr(e)?"ephemeral":lt(e)?"parameterized":"unknown"}function ki(e,t){const n=t instanceof Array?t:[t];return Yt(e)&&n.includes(e.kind)||!1}var Ri=0,Rr=1,$i=2,Ui=3,Ni=4,Oi=5,tn=6,nn=7,Ci=8,$r=13,Ur=14,rn=16,Nr=40,Or=41,Cr=42,Hr=43,Pr=44,Hi=1040,Mr=1059,Pi=1063,Mi=1311,qi=1971,Wi=1984,ji=1984,Di=1985,zi=4550,Vi=5999,Ki=6999,Zi=7e3,Fi=9041,Gi=9734,Ji=9735,Yi=9802,Xi=1e4,Qi=10001,ea=10002,ta=10003,na=10004,ra=10005,oa=10006,sa=10007,ia=10015,aa=10030,ca=10050,la=10096,ua=13194,fa=21e3,qr=22242,Wr=23194,da=23195,ha=24133,on=27235,pa=3e4,ga=30001,ya=30002,wa=30003,ba=30004,Ea=30008,va=30009,ma=30015,xa=30017,Aa=30018,Sa=30023,_a=30024,Ba=30030,Ia=30078,Ta=30311,La=30315,ka=30402,Ra=30403,$a=31922,Ua=31923,Na=31924,Oa=31925,Ca=31989,Ha=31990,Pa=34550;function Ma(e,t){if(e.ids&&e.ids.indexOf(t.id)===-1||e.kinds&&e.kinds.indexOf(t.kind)===-1||e.authors&&e.authors.indexOf(t.pubkey)===-1)return!1;for(let n in e)if(n[0]==="#"){let r=n.slice(1),o=e[`#${r}`];if(o&&!t.tags.find(([s,i])=>s===n.slice(1)&&o.indexOf(i)!==-1))return!1}return!(e.since&&t.created_at<e.since||e.until&&t.created_at>e.until)}function qa(e,t){for(let n=0;n<e.length;n++)if(Ma(e[n],t))return!0;return!1}var Wa={};q(Wa,{getHex64:()=>ut,getInt:()=>jr,getSubscriptionId:()=>Dr,matchEventId:()=>ja,matchEventKind:()=>za,matchEventPubkey:()=>Da});function ut(e,t){let n=t.length+3,r=e.indexOf(`"${t}":`)+n,o=e.slice(r).indexOf('"')+r+1;return e.slice(o,o+64)}function jr(e,t){let n=t.length,r=e.indexOf(`"${t}":`)+n+3,o=e.slice(r),s=Math.min(o.indexOf(","),o.indexOf("}"));return parseInt(o.slice(0,s),10)}function Dr(e){let t=e.slice(0,22).indexOf('"EVENT"');if(t===-1)return null;let n=e.slice(t+7+1).indexOf('"');if(n===-1)return null;let r=t+7+1+n,o=e.slice(r+1,80).indexOf('"');if(o===-1)return null;let s=r+1+o;return e.slice(r+1,s)}function ja(e,t){return t===ut(e,"id")}function Da(e,t){return t===ut(e,"pubkey")}function za(e,t){return t===jr(e,"kind")}var Va={};q(Va,{makeAuthEvent:()=>zr});function zr(e,t){return{kind:qr,created_at:Math.floor(Date.now()/1e3),tags:[["relay",e],["challenge",t]],content:""}}async function Ka(){return new Promise(e=>{const t=new MessageChannel,n=()=>{t.port1.removeEventListener("message",n),e()};t.port1.addEventListener("message",n),t.port2.postMessage(0),t.port1.start()})}var Za=e=>(e[Ae]=!0,!0),Vr=class{constructor(e,t){B(this,"url");B(this,"_connected",!1);B(this,"onclose",null);B(this,"onnotice",e=>console.debug(`NOTICE from ${this.url}: ${e}`));B(this,"_onauth",null);B(this,"baseEoseTimeout",4400);B(this,"connectionTimeout",4400);B(this,"publishTimeout",4400);B(this,"openSubs",new Map);B(this,"connectionTimeoutHandle");B(this,"connectionPromise");B(this,"openCountRequests",new Map);B(this,"openEventPublishes",new Map);B(this,"ws");B(this,"incomingMessageQueue",new Tr);B(this,"queueRunning",!1);B(this,"challenge");B(this,"authPromise");B(this,"serial",0);B(this,"verifyEvent");B(this,"_WebSocket");this.url=_e(e),this.verifyEvent=t.verifyEvent,this._WebSocket=t.websocketImplementation||WebSocket}static async connect(e,t){const n=new Vr(e,t);return await n.connect(),n}closeAllSubscriptions(e){for(let[t,n]of this.openSubs)n.close(e);this.openSubs.clear();for(let[t,n]of this.openEventPublishes)n.reject(new Error(e));this.openEventPublishes.clear();for(let[t,n]of this.openCountRequests)n.reject(new Error(e));this.openCountRequests.clear()}get connected(){return this._connected}async connect(){return this.connectionPromise?this.connectionPromise:(this.challenge=void 0,this.authPromise=void 0,this.connectionPromise=new Promise((e,t)=>{this.connectionTimeoutHandle=setTimeout(()=>{var n;t("connection timed out"),this.connectionPromise=void 0,(n=this.onclose)==null||n.call(this),this.closeAllSubscriptions("relay connection timed out")},this.connectionTimeout);try{this.ws=new this._WebSocket(this.url)}catch(n){clearTimeout(this.connectionTimeoutHandle),t(n);return}this.ws.onopen=()=>{clearTimeout(this.connectionTimeoutHandle),this._connected=!0,e()},this.ws.onerror=n=>{var r;clearTimeout(this.connectionTimeoutHandle),t(n.message||"websocket error"),this._connected&&(this._connected=!1,this.connectionPromise=void 0,(r=this.onclose)==null||r.call(this),this.closeAllSubscriptions("relay connection errored"))},this.ws.onclose=async()=>{var n;this._connected&&(this._connected=!1,this.connectionPromise=void 0,(n=this.onclose)==null||n.call(this),this.closeAllSubscriptions("relay connection closed"))},this.ws.onmessage=this._onmessage.bind(this)}),this.connectionPromise)}async runQueue(){for(this.queueRunning=!0;this.handleNext()!==!1;)await Ka();this.queueRunning=!1}handleNext(){var n,r,o;const e=this.incomingMessageQueue.dequeue();if(!e)return!1;const t=Dr(e);if(t){const s=this.openSubs.get(t);if(!s)return;const i=ut(e,"id"),c=(n=s.alreadyHaveEvent)==null?void 0:n.call(s,i);if((r=s.receivedEvent)==null||r.call(s,this,i),c)return}try{let s=JSON.parse(e);switch(s[0]){case"EVENT":{const i=this.openSubs.get(s[1]),c=s[2];this.verifyEvent(c)&&qa(i.filters,c)&&i.onevent(c);return}case"COUNT":{const i=s[1],c=s[2],a=this.openCountRequests.get(i);a&&(a.resolve(c.count),this.openCountRequests.delete(i));return}case"EOSE":{const i=this.openSubs.get(s[1]);if(!i)return;i.receivedEose();return}case"OK":{const i=s[1],c=s[2],a=s[3],u=this.openEventPublishes.get(i);u&&(clearTimeout(u.timeout),c?u.resolve(a):u.reject(new Error(a)),this.openEventPublishes.delete(i));return}case"CLOSED":{const i=s[1],c=this.openSubs.get(i);if(!c)return;c.closed=!0,c.close(s[2]);return}case"NOTICE":this.onnotice(s[1]);return;case"AUTH":{this.challenge=s[1],(o=this._onauth)==null||o.call(this,s[1]);return}}}catch{return}}async send(e){if(!this.connectionPromise)throw new Error("sending on closed connection");this.connectionPromise.then(()=>{var t;(t=this.ws)==null||t.send(e)})}async auth(e){const t=this.challenge;if(!t)throw new Error("can't perform auth, no challenge was received");return this.authPromise?this.authPromise:(this.authPromise=new Promise(async(n,r)=>{const o=await e(zr(this.url,t)),s=setTimeout(()=>{const i=this.openEventPublishes.get(o.id);i&&(i.reject(new Error("auth timed out")),this.openEventPublishes.delete(o.id))},this.publishTimeout);this.openEventPublishes.set(o.id,{resolve:n,reject:r,timeout:s}),this.send('["AUTH",'+JSON.stringify(o)+"]")}),this.authPromise)}async publish(e){const t=new Promise((n,r)=>{const o=setTimeout(()=>{const s=this.openEventPublishes.get(e.id);s&&(s.reject(new Error("publish timed out")),this.openEventPublishes.delete(e.id))},this.publishTimeout);this.openEventPublishes.set(e.id,{resolve:n,reject:r,timeout:o})});return this.send('["EVENT",'+JSON.stringify(e)+"]"),t}async count(e,t){this.serial++;const n=(t==null?void 0:t.id)||"count:"+this.serial,r=new Promise((o,s)=>{this.openCountRequests.set(n,{resolve:o,reject:s})});return this.send('["COUNT","'+n+'",'+JSON.stringify(e).substring(1)),r}subscribe(e,t){const n=this.prepareSubscription(e,t);return n.fire(),n}prepareSubscription(e,t){this.serial++;const n=t.id||(t.label?t.label+":":"sub:")+this.serial,r=new Fa(this,n,e,t);return this.openSubs.set(n,r),r}close(){var e;this.closeAllSubscriptions("relay connection closed by us"),this._connected=!1,(e=this.ws)==null||e.close()}_onmessage(e){this.incomingMessageQueue.enqueue(e.data),this.queueRunning||this.runQueue()}},Fa=class{constructor(e,t,n,r){B(this,"relay");B(this,"id");B(this,"closed",!1);B(this,"eosed",!1);B(this,"filters");B(this,"alreadyHaveEvent");B(this,"receivedEvent");B(this,"onevent");B(this,"oneose");B(this,"onclose");B(this,"eoseTimeout");B(this,"eoseTimeoutHandle");this.relay=e,this.filters=n,this.id=t,this.alreadyHaveEvent=r.alreadyHaveEvent,this.receivedEvent=r.receivedEvent,this.eoseTimeout=r.eoseTimeout||e.baseEoseTimeout,this.oneose=r.oneose,this.onclose=r.onclose,this.onevent=r.onevent||(o=>{console.warn(`onevent() callback not defined for subscription '${this.id}' in relay ${this.relay.url}. event received:`,o)})}fire(){this.relay.send('["REQ","'+this.id+'",'+JSON.stringify(this.filters).substring(1)),this.eoseTimeoutHandle=setTimeout(this.receivedEose.bind(this),this.eoseTimeout)}receivedEose(){var e;this.eosed||(clearTimeout(this.eoseTimeoutHandle),this.eosed=!0,(e=this.oneose)==null||e.call(this))}close(e="closed by caller"){var t;!this.closed&&this.relay.connected&&(this.relay.send('["CLOSE",'+JSON.stringify(this.id)+"]"),this.closed=!0),this.relay.openSubs.delete(this.id),(t=this.onclose)==null||t.call(this,e)}},Ga;try{Ga=WebSocket}catch{}var Ja=class{constructor(e){B(this,"relays",new Map);B(this,"seenOn",new Map);B(this,"trackRelays",!1);B(this,"verifyEvent");B(this,"trustedRelayURLs",new Set);B(this,"_WebSocket");this.verifyEvent=e.verifyEvent,this._WebSocket=e.websocketImplementation}async ensureRelay(e,t){e=_e(e);let n=this.relays.get(e);return n||(n=new Vr(e,{verifyEvent:this.trustedRelayURLs.has(e)?Za:this.verifyEvent,websocketImplementation:this._WebSocket}),t!=null&&t.connectionTimeout&&(n.connectionTimeout=t.connectionTimeout),this.relays.set(e,n)),await n.connect(),n}close(e){e.map(_e).forEach(t=>{var n;(n=this.relays.get(t))==null||n.close()})}subscribe(e,t,n){return this.subscribeMap(e.map(r=>({url:r,filter:t})),n)}subscribeMany(e,t,n){return this.subscribeMap(e.flatMap(r=>t.map(o=>({url:r,filter:o}))),n)}subscribeMap(e,t){this.trackRelays&&(t.receivedEvent=(f,l)=>{let h=this.seenOn.get(l);h||(h=new Set,this.seenOn.set(l,h)),h.add(f)});const n=new Set,r=[],o=[];let s=f=>{var l;o[f]||(o[f]=!0,o.filter(h=>h).length===e.length&&((l=t.oneose)==null||l.call(t),s=()=>{}))};const i=[];let c=(f,l)=>{var h;i[f]||(s(f),i[f]=l,i.filter(g=>g).length===e.length&&((h=t.onclose)==null||h.call(t,i),c=()=>{}))};const a=f=>{var h;if((h=t.alreadyHaveEvent)!=null&&h.call(t,f))return!0;const l=n.has(f);return n.add(f),l},u=Promise.all(e.map(async({url:f,filter:l},h)=>{f=_e(f);let g;try{g=await this.ensureRelay(f,{connectionTimeout:t.maxWait?Math.max(t.maxWait*.8,t.maxWait-1e3):void 0})}catch(d){c(h,(d==null?void 0:d.message)||String(d));return}let y=g.subscribe([l],{...t,oneose:()=>s(h),onclose:d=>{d.startsWith("auth-required:")&&t.doauth?g.auth(t.doauth).then(()=>{g.subscribe([l],{...t,oneose:()=>s(h),onclose:p=>{c(h,p)},alreadyHaveEvent:a,eoseTimeout:t.maxWait})}).catch(p=>{c(h,`auth was required and attempted, but failed with: ${p}`)}):c(h,d)},alreadyHaveEvent:a,eoseTimeout:t.maxWait});r.push(y)}));return{async close(){await u,r.forEach(f=>{f.close()})}}}subscribeManyMap(e,t){this.trackRelays&&(t.receivedEvent=(l,h)=>{let g=this.seenOn.get(h);g||(g=new Set,this.seenOn.set(h,g)),g.add(l)});const n=new Set,r=[],o=Object.keys(e).length,s=[];let i=l=>{var h;s[l]||(s[l]=!0,s.filter(g=>g).length===o&&((h=t.oneose)==null||h.call(t),i=()=>{}))};const c=[];let a=(l,h)=>{var g;c[l]||(i(l),c[l]=h,c.filter(y=>y).length===o&&((g=t.onclose)==null||g.call(t,c),a=()=>{}))};const u=l=>{var g;if((g=t.alreadyHaveEvent)!=null&&g.call(t,l))return!0;const h=n.has(l);return n.add(l),h},f=Promise.all(Object.entries(e).map(async(l,h,g)=>{if(g.indexOf(l)!==h){a(h,"duplicate url");return}let[y,d]=l;y=_e(y);let p;try{p=await this.ensureRelay(y,{connectionTimeout:t.maxWait?Math.max(t.maxWait*.8,t.maxWait-1e3):void 0})}catch(v){a(h,(v==null?void 0:v.message)||String(v));return}let w=p.subscribe(d,{...t,oneose:()=>i(h),onclose:v=>{v.startsWith("auth-required:")&&t.doauth?p.auth(t.doauth).then(()=>{p.subscribe(d,{...t,oneose:()=>i(h),onclose:S=>{a(h,S)},alreadyHaveEvent:u,eoseTimeout:t.maxWait})}).catch(S=>{a(h,`auth was required and attempted, but failed with: ${S}`)}):a(h,v)},alreadyHaveEvent:u,eoseTimeout:t.maxWait});r.push(w)}));return{async close(){await f,r.forEach(l=>{l.close()})}}}subscribeEose(e,t,n){const r=this.subscribe(e,t,{...n,oneose(){r.close()}});return r}subscribeManyEose(e,t,n){const r=this.subscribeMany(e,t,{...n,oneose(){r.close()}});return r}async querySync(e,t,n){return new Promise(async r=>{const o=[];this.subscribeEose(e,t,{...n,onevent(s){o.push(s)},onclose(s){r(o)}})})}async get(e,t,n){t.limit=1;const r=await this.querySync(e,t,n);return r.sort((o,s)=>s.created_at-o.created_at),r[0]||null}publish(e,t){return e.map(_e).map(async(n,r,o)=>{if(o.indexOf(n)!==r)return Promise.reject("duplicate url");let s=await this.ensureRelay(n);return s.publish(t).then(i=>{if(this.trackRelays){let c=this.seenOn.get(t.id);c||(c=new Set,this.seenOn.set(t.id,c)),c.add(s)}return i})})}listConnectionStatus(){const e=new Map;return this.relays.forEach((t,n)=>e.set(n,t.connected)),e}destroy(){this.relays.forEach(e=>e.close()),this.relays=new Map}},Kr;try{Kr=WebSocket}catch{}var Ya=class extends Ja{constructor(){super({verifyEvent:ct,websocketImplementation:Kr})}},Xa={};q(Xa,{BECH32_REGEX:()=>Zr,Bech32MaxSize:()=>sn,NostrTypeGuard:()=>Qa,decode:()=>ft,decodeNostrURI:()=>tc,encodeBytes:()=>ht,naddrEncode:()=>ac,neventEncode:()=>ic,noteEncode:()=>oc,nprofileEncode:()=>sc,npubEncode:()=>rc,nsecEncode:()=>nc});var Qa={isNProfile:e=>/^nprofile1[a-z\d]+$/.test(e||""),isNEvent:e=>/^nevent1[a-z\d]+$/.test(e||""),isNAddr:e=>/^naddr1[a-z\d]+$/.test(e||""),isNSec:e=>/^nsec1[a-z\d]{58}$/.test(e||""),isNPub:e=>/^npub1[a-z\d]{58}$/.test(e||""),isNote:e=>/^note1[a-z\d]+$/.test(e||""),isNcryptsec:e=>/^ncryptsec1[a-z\d]+$/.test(e||"")},sn=5e3,Zr=/[\x21-\x7E]{1,83}1[023456789acdefghjklmnpqrstuvwxyz]{6,}/;function ec(e){const t=new Uint8Array(4);return t[0]=e>>24&255,t[1]=e>>16&255,t[2]=e>>8&255,t[3]=e&255,t}function tc(e){try{return e.startsWith("nostr:")&&(e=e.substring(6)),ft(e)}catch{return{type:"invalid",data:null}}}function ft(e){var o,s,i,c,a,u,f;let{prefix:t,words:n}=Ce.decode(e,sn),r=new Uint8Array(Ce.fromWords(n));switch(t){case"nprofile":{let l=It(r);if(!((o=l[0])!=null&&o[0]))throw new Error("missing TLV 0 for nprofile");if(l[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");return{type:"nprofile",data:{pubkey:Z(l[0][0]),relays:l[1]?l[1].map(h=>ae.decode(h)):[]}}}case"nevent":{let l=It(r);if(!((s=l[0])!=null&&s[0]))throw new Error("missing TLV 0 for nevent");if(l[0][0].length!==32)throw new Error("TLV 0 should be 32 bytes");if(l[2]&&l[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(l[3]&&l[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"nevent",data:{id:Z(l[0][0]),relays:l[1]?l[1].map(h=>ae.decode(h)):[],author:(i=l[2])!=null&&i[0]?Z(l[2][0]):void 0,kind:(c=l[3])!=null&&c[0]?parseInt(Z(l[3][0]),16):void 0}}}case"naddr":{let l=It(r);if(!((a=l[0])!=null&&a[0]))throw new Error("missing TLV 0 for naddr");if(!((u=l[2])!=null&&u[0]))throw new Error("missing TLV 2 for naddr");if(l[2][0].length!==32)throw new Error("TLV 2 should be 32 bytes");if(!((f=l[3])!=null&&f[0]))throw new Error("missing TLV 3 for naddr");if(l[3][0].length!==4)throw new Error("TLV 3 should be 4 bytes");return{type:"naddr",data:{identifier:ae.decode(l[0][0]),pubkey:Z(l[2][0]),kind:parseInt(Z(l[3][0]),16),relays:l[1]?l[1].map(h=>ae.decode(h)):[]}}}case"nsec":return{type:t,data:r};case"npub":case"note":return{type:t,data:Z(r)};default:throw new Error(`unknown prefix ${t}`)}}function It(e){let t={},n=e;for(;n.length>0;){let r=n[0],o=n[1],s=n.slice(2,2+o);if(n=n.slice(2+o),s.length<o)throw new Error(`not enough data to read on TLV ${r}`);t[r]=t[r]||[],t[r].push(s)}return t}function nc(e){return ht("nsec",e)}function rc(e){return ht("npub",Oe(e))}function oc(e){return ht("note",Oe(e))}function dt(e,t){let n=Ce.toWords(t);return Ce.encode(e,n,sn)}function ht(e,t){return dt(e,t)}function sc(e){let t=an({0:[Oe(e.pubkey)],1:(e.relays||[]).map(n=>Q.encode(n))});return dt("nprofile",t)}function ic(e){let t;e.kind!==void 0&&(t=ec(e.kind));let n=an({0:[Oe(e.id)],1:(e.relays||[]).map(r=>Q.encode(r)),2:e.author?[Oe(e.author)]:[],3:t?[new Uint8Array(t)]:[]});return dt("nevent",n)}function ac(e){let t=new ArrayBuffer(4);new DataView(t).setUint32(0,e.kind,!1);let n=an({0:[Q.encode(e.identifier)],1:(e.relays||[]).map(r=>Q.encode(r)),2:[Oe(e.pubkey)],3:[new Uint8Array(t)]});return dt("naddr",n)}function an(e){let t=[];return Object.entries(e).reverse().forEach(([n,r])=>{r.forEach(o=>{let s=new Uint8Array(o.length+2);s.set([parseInt(n)],0),s.set([o.length],1),s.set(o,2),t.push(s)})}),ot(...t)}var cc={};q(cc,{decrypt:()=>lc,encrypt:()=>Fr});function Fr(e,t,n){const r=e instanceof Uint8Array?Z(e):e,o=He.getSharedSecret(r,"02"+t),s=Gr(o);let i=Uint8Array.from(fr(16)),c=Q.encode(n),a=mr(s,i).encrypt(c),u=ce.encode(new Uint8Array(a)),f=ce.encode(new Uint8Array(i.buffer));return`${u}?iv=${f}`}function lc(e,t,n){const r=e instanceof Uint8Array?Z(e):e;let[o,s]=n.split("?iv="),i=He.getSharedSecret(r,"02"+t),c=Gr(i),a=ce.decode(s),u=ce.decode(o),f=mr(c,a).decrypt(u);return ae.decode(f)}function Gr(e){return e.slice(1,33)}var uc={};q(uc,{NIP05_REGEX:()=>cn,isNip05:()=>fc,isValid:()=>pc,queryProfile:()=>Jr,searchDomain:()=>hc,useFetchImplementation:()=>dc});var cn=/^(?:([\w.+-]+)@)?([\w_-]+(\.[\w_-]+)+)$/,fc=e=>cn.test(e||""),pt;try{pt=fetch}catch{}function dc(e){pt=e}async function hc(e,t=""){try{const n=`https://${e}/.well-known/nostr.json?name=${t}`,r=await pt(n,{redirect:"manual"});if(r.status!==200)throw Error("Wrong response code");return(await r.json()).names}catch{return{}}}async function Jr(e){var o;const t=e.match(cn);if(!t)return null;const[,n="_",r]=t;try{const s=`https://${r}/.well-known/nostr.json?name=${n}`,i=await pt(s,{redirect:"manual"});if(i.status!==200)throw Error("Wrong response code");const c=await i.json(),a=c.names[n];return a?{pubkey:a,relays:(o=c.relays)==null?void 0:o[a]}:null}catch{return null}}async function pc(e,t){const n=await Jr(t);return n?n.pubkey===e:!1}var gc={};q(gc,{parse:()=>yc});function yc(e){const t={reply:void 0,root:void 0,mentions:[],profiles:[],quotes:[]};let n,r;for(let o=e.tags.length-1;o>=0;o--){const s=e.tags[o];if(s[0]==="e"&&s[1]){const[i,c,a,u,f]=s,l={id:c,relays:a?[a]:[],author:f};if(u==="root"){t.root=l;continue}if(u==="reply"){t.reply=l;continue}if(u==="mention"){t.mentions.push(l);continue}n?r=l:n=l,t.mentions.push(l);continue}if(s[0]==="q"&&s[1]){const[i,c,a]=s;t.quotes.push({id:c,relays:a?[a]:[]})}if(s[0]==="p"&&s[1]){t.profiles.push({pubkey:s[1],relays:s[2]?[s[2]]:[]});continue}}return t.root||(t.root=r||n||t.reply),t.reply||(t.reply=n||t.root),[t.reply,t.root].forEach(o=>{if(!o)return;let s=t.mentions.indexOf(o);if(s!==-1&&t.mentions.splice(s,1),o.author){let i=t.profiles.find(c=>c.pubkey===o.author);i&&i.relays&&(o.relays||(o.relays=[]),i.relays.forEach(c=>{var a;((a=o.relays)==null?void 0:a.indexOf(c))===-1&&o.relays.push(c)}),i.relays=o.relays)}}),t.mentions.forEach(o=>{if(o.author){let s=t.profiles.find(i=>i.pubkey===o.author);s&&s.relays&&(o.relays||(o.relays=[]),s.relays.forEach(i=>{o.relays.indexOf(i)===-1&&o.relays.push(i)}),s.relays=o.relays)}}),t}var wc={};q(wc,{fetchRelayInformation:()=>Ec,useFetchImplementation:()=>bc});var Yr;try{Yr=fetch}catch{}function bc(e){Yr=e}async function Ec(e){return await(await fetch(e.replace("ws://","http://").replace("wss://","https://"),{headers:{Accept:"application/nostr+json"}})).json()}var vc={};q(vc,{fastEventHash:()=>Qr,getPow:()=>Xr,minePow:()=>mc});function Xr(e){let t=0;for(let n=0;n<64;n+=8){const r=parseInt(e.substring(n,n+8),16);if(r===0)t+=32;else{t+=Math.clz32(r);break}}return t}function mc(e,t){let n=0;const r=e,o=["nonce",n.toString(),t.toString()];for(r.tags.push(o);;){const s=Math.floor(new Date().getTime()/1e3);if(s!==r.created_at&&(n=0,r.created_at=s),o[1]=(++n).toString(),r.id=Qr(r),Xr(r.id)>=t)break}return r}function Qr(e){return Z(Pe(Q.encode(JSON.stringify([0,e.pubkey,e.created_at,e.kind,e.tags,e.content]))))}var xc={};q(xc,{unwrapEvent:()=>Nc,unwrapManyEvents:()=>Oc,wrapEvent:()=>ho,wrapManyEvents:()=>Uc});var Ac={};q(Ac,{createRumor:()=>co,createSeal:()=>lo,createWrap:()=>uo,unwrapEvent:()=>hn,unwrapManyEvents:()=>fo,wrapEvent:()=>Qe,wrapManyEvents:()=>Rc});var Sc={};q(Sc,{decrypt:()=>dn,encrypt:()=>fn,getConversationKey:()=>ln,v2:()=>Lc});var eo=1,to=65535;function ln(e,t){const n=He.getSharedSecret(e,"02"+t).subarray(1,33);return wi(Pe,n,"nip44-v2")}function no(e,t){const n=bi(Pe,e,t,76);return{chacha_key:n.subarray(0,32),chacha_nonce:n.subarray(32,44),hmac_key:n.subarray(44,76)}}function un(e){if(!Number.isSafeInteger(e)||e<1)throw new Error("expected positive integer");if(e<=32)return 32;const t=1<<Math.floor(Math.log2(e-1))+1,n=t<=256?32:t/8;return n*(Math.floor((e-1)/n)+1)}function _c(e){if(!Number.isSafeInteger(e)||e<eo||e>to)throw new Error("invalid plaintext size: must be between 1 and 65535 bytes");const t=new Uint8Array(2);return new DataView(t.buffer).setUint16(0,e,!1),t}function Bc(e){const t=Q.encode(e),n=t.length,r=_c(n),o=new Uint8Array(un(n)-n);return ot(r,t,o)}function Ic(e){const t=new DataView(e.buffer).getUint16(0),n=e.subarray(2,2+t);if(t<eo||t>to||n.length!==t||e.length!==2+un(t))throw new Error("invalid padding");return ae.decode(n)}function ro(e,t,n){if(n.length!==32)throw new Error("AAD associated data must be 32 bytes");const r=ot(n,t);return it(Pe,e,r)}function Tc(e){if(typeof e!="string")throw new Error("payload must be a valid string");const t=e.length;if(t<132||t>87472)throw new Error("invalid payload length: "+t);if(e[0]==="#")throw new Error("unknown encryption version");let n;try{n=ce.decode(e)}catch(s){throw new Error("invalid base64: "+s.message)}const r=n.length;if(r<99||r>65603)throw new Error("invalid data length: "+r);const o=n[0];if(o!==2)throw new Error("unknown encryption version "+o);return{nonce:n.subarray(1,33),ciphertext:n.subarray(33,-32),mac:n.subarray(-32)}}function fn(e,t,n=fr(32)){const{chacha_key:r,chacha_nonce:o,hmac_key:s}=no(t,n),i=Bc(e),c=_r(r,o,i),a=ro(s,c,n);return ce.encode(ot(new Uint8Array([2]),n,c,a))}function dn(e,t){const{nonce:n,ciphertext:r,mac:o}=Tc(e),{chacha_key:s,chacha_nonce:i,hmac_key:c}=no(t,n),a=ro(c,r,n);if(!Xs(a,o))throw new Error("invalid MAC");const u=_r(s,i,r);return Ic(u)}var Lc={utils:{getConversationKey:ln,calcPaddedLen:un},encrypt:fn,decrypt:dn},kc=2*24*60*60,oo=()=>Math.round(Date.now()/1e3),so=()=>Math.round(oo()-Math.random()*kc),io=(e,t)=>ln(e,t),ao=(e,t,n)=>fn(JSON.stringify(e),io(t,n)),Wn=(e,t)=>JSON.parse(dn(e.content,io(t,e.pubkey)));function co(e,t){const n={created_at:oo(),content:"",tags:[],...e,pubkey:Qt(t)};return n.id=Ze(n),n}function lo(e,t,n){return oe({kind:$r,content:ao(e,t,n),created_at:so(),tags:[]},t)}function uo(e,t){const n=Bi();return oe({kind:Mr,content:ao(e,n,t),created_at:so(),tags:[["p",t]]},n)}function Qe(e,t,n){const r=co(e,t),o=lo(r,t,n);return uo(o,n)}function Rc(e,t,n){if(!n||n.length===0)throw new Error("At least one recipient is required.");const r=Qt(t),o=[Qe(e,t,r)];return n.forEach(s=>{o.push(Qe(e,t,s))}),o}function hn(e,t){const n=Wn(e,t);return Wn(n,t)}function fo(e,t){let n=[];return e.forEach(r=>{n.push(hn(r,t))}),n.sort((r,o)=>r.created_at-o.created_at),n}function $c(e,t,n,r){const o={created_at:Math.ceil(Date.now()/1e3),kind:Ur,tags:[],content:t};return(Array.isArray(e)?e:[e]).forEach(({publicKey:i,relayUrl:c})=>{o.tags.push(c?["p",i,c]:["p",i])}),r&&o.tags.push(["e",r.eventId,r.relayUrl||"","reply"]),n&&o.tags.push(["subject",n]),o}function ho(e,t,n,r,o){const s=$c(t,n,r,o);return Qe(s,e,t.publicKey)}function Uc(e,t,n,r,o){if(!t||t.length===0)throw new Error("At least one recipient is required.");return[{publicKey:Qt(e)},...t].map(i=>ho(e,i,n,r,o))}var Nc=hn,Oc=fo,Cc={};q(Cc,{finishRepostEvent:()=>Hc,getRepostedEvent:()=>Pc,getRepostedEventPointer:()=>po});function Hc(e,t,n,r){var i;let o;const s=[...e.tags??[],["e",t.id,n],["p",t.pubkey]];return t.kind===Rr?o=tn:(o=rn,s.push(["k",String(t.kind)])),oe({kind:o,tags:s,content:e.content===""||(i=t.tags)!=null&&i.find(c=>c[0]==="-")?"":JSON.stringify(t),created_at:e.created_at},r)}function po(e){if(![tn,rn].includes(e.kind))return;let t,n;for(let r=e.tags.length-1;r>=0&&(t===void 0||n===void 0);r--){const o=e.tags[r];o.length>=2&&(o[0]==="e"&&t===void 0?t=o:o[0]==="p"&&n===void 0&&(n=o))}if(t!==void 0)return{id:t[1],relays:[t[2],n==null?void 0:n[2]].filter(r=>typeof r=="string"),author:n==null?void 0:n[1]}}function Pc(e,{skipVerification:t}={}){const n=po(e);if(n===void 0||e.content==="")return;let r;try{r=JSON.parse(e.content)}catch{return}if(r.id===n.id&&!(!t&&!ct(r)))return r}var Mc={};q(Mc,{NOSTR_URI_REGEX:()=>pn,parse:()=>Wc,test:()=>qc});var pn=new RegExp(`nostr:(${Zr.source})`);function qc(e){return typeof e=="string"&&new RegExp(`^${pn.source}$`).test(e)}function Wc(e){const t=e.match(new RegExp(`^${pn.source}$`));if(!t)throw new Error(`Invalid Nostr URI: ${e}`);return{uri:t[0],value:t[1],decoded:ft(t[1])}}var jc={};q(jc,{finishReactionEvent:()=>Dc,getReactedEventPointer:()=>zc});function Dc(e,t,n){const r=t.tags.filter(o=>o.length>=2&&(o[0]==="e"||o[0]==="p"));return oe({...e,kind:nn,tags:[...e.tags??[],...r,["e",t.id],["p",t.pubkey]],content:e.content??"+"},n)}function zc(e){if(e.kind!==nn)return;let t,n;for(let r=e.tags.length-1;r>=0&&(t===void 0||n===void 0);r--){const o=e.tags[r];o.length>=2&&(o[0]==="e"&&t===void 0?t=o:o[0]==="p"&&n===void 0&&(n=o))}if(!(t===void 0||n===void 0))return{id:t[1],relays:[t[2],n[2]].filter(r=>r!==void 0),author:n[1]}}var Vc={};q(Vc,{parse:()=>Zc});var Kc=/\W/m,jn=/\W |\W$|$|,| /m;function*Zc(e){const t=e.length;let n=0,r=0;for(;r<t;){let o=e.indexOf(":",r);if(o===-1)break;if(e.substring(o-5,o)==="nostr"){const s=e.substring(o+60).match(Kc),i=s?o+60+s.index:t;try{let c,{data:a,type:u}=ft(e.substring(o+1,i));switch(u){case"npub":c={pubkey:a};break;case"nsec":case"note":r=i+1;continue;default:c=a}n!==o-5&&(yield{type:"text",text:e.substring(n,o-5)}),yield{type:"reference",pointer:c},r=i,n=r;continue}catch{r=o+1;continue}}else if(e.substring(o-5,o)==="https"||e.substring(o-4,o)==="http"){const s=e.substring(o+4).match(jn),i=s?o+4+s.index:t,c=e[o-1]==="s"?5:4;try{let a=new URL(e.substring(o-c,i));if(a.hostname.indexOf(".")===-1)throw new Error("invalid url");if(n!==o-c&&(yield{type:"text",text:e.substring(n,o-c)}),a.pathname.endsWith(".png")||a.pathname.endsWith(".jpg")||a.pathname.endsWith(".jpeg")||a.pathname.endsWith(".gif")||a.pathname.endsWith(".webp")){yield{type:"image",url:a.toString()},r=i,n=r;continue}if(a.pathname.endsWith(".mp4")||a.pathname.endsWith(".avi")||a.pathname.endsWith(".webm")||a.pathname.endsWith(".mkv")){yield{type:"video",url:a.toString()},r=i,n=r;continue}if(a.pathname.endsWith(".mp3")||a.pathname.endsWith(".aac")||a.pathname.endsWith(".ogg")||a.pathname.endsWith(".opus")){yield{type:"audio",url:a.toString()},r=i,n=r;continue}yield{type:"url",url:a.toString()},r=i,n=r;continue}catch{r=i+1;continue}}else if(e.substring(o-3,o)==="wss"||e.substring(o-2,o)==="ws"){const s=e.substring(o+4).match(jn),i=s?o+4+s.index:t,c=e[o-1]==="s"?3:2;try{let a=new URL(e.substring(o-c,i));if(a.hostname.indexOf(".")===-1)throw new Error("invalid ws url");n!==o-c&&(yield{type:"text",text:e.substring(n,o-c)}),yield{type:"relay",url:a.toString()},r=i,n=r;continue}catch{r=i+1;continue}}else{r=o+1;continue}}n!==t&&(yield{type:"text",text:e.substring(n)})}var Fc={};q(Fc,{channelCreateEvent:()=>Gc,channelHideMessageEvent:()=>Xc,channelMessageEvent:()=>Yc,channelMetadataEvent:()=>Jc,channelMuteUserEvent:()=>Qc});var Gc=(e,t)=>{let n;if(typeof e.content=="object")n=JSON.stringify(e.content);else if(typeof e.content=="string")n=e.content;else return;return oe({kind:Nr,tags:[...e.tags??[]],content:n,created_at:e.created_at},t)},Jc=(e,t)=>{let n;if(typeof e.content=="object")n=JSON.stringify(e.content);else if(typeof e.content=="string")n=e.content;else return;return oe({kind:Or,tags:[["e",e.channel_create_event_id],...e.tags??[]],content:n,created_at:e.created_at},t)},Yc=(e,t)=>{const n=[["e",e.channel_create_event_id,e.relay_url,"root"]];return e.reply_to_channel_message_event_id&&n.push(["e",e.reply_to_channel_message_event_id,e.relay_url,"reply"]),oe({kind:Cr,tags:[...n,...e.tags??[]],content:e.content,created_at:e.created_at},t)},Xc=(e,t)=>{let n;if(typeof e.content=="object")n=JSON.stringify(e.content);else if(typeof e.content=="string")n=e.content;else return;return oe({kind:Hr,tags:[["e",e.channel_message_event_id],...e.tags??[]],content:n,created_at:e.created_at},t)},Qc=(e,t)=>{let n;if(typeof e.content=="object")n=JSON.stringify(e.content);else if(typeof e.content=="string")n=e.content;else return;return oe({kind:Pr,tags:[["p",e.pubkey_to_mute],...e.tags??[]],content:n,created_at:e.created_at},t)},el={};q(el,{EMOJI_SHORTCODE_REGEX:()=>go,matchAll:()=>tl,regex:()=>gn,replaceAll:()=>nl});var go=/:(\w+):/,gn=()=>new RegExp(`\\B${go.source}\\B`,"g");function*tl(e){const t=e.matchAll(gn());for(const n of t)try{const[r,o]=n;yield{shortcode:r,name:o,start:n.index,end:n.index+r.length}}catch{}}function nl(e,t){return e.replaceAll(gn(),(n,r)=>t({shortcode:n,name:r}))}var rl={};q(rl,{useFetchImplementation:()=>ol,validateGithub:()=>sl});var yn;try{yn=fetch}catch{}function ol(e){yn=e}async function sl(e,t,n){try{return await(await yn(`https://gist.github.com/${t}/${n}/raw`)).text()===`Verifying that I control the following Nostr public key: ${e}`}catch{return!1}}var il={};q(il,{makeNwcRequestEvent:()=>cl,parseConnectionString:()=>al});function al(e){const{pathname:t,searchParams:n}=new URL(e),r=t,o=n.get("relay"),s=n.get("secret");if(!r||!o||!s)throw new Error("invalid connection string");return{pubkey:r,relay:o,secret:s}}async function cl(e,t,n){const o=await Fr(t,e,JSON.stringify({method:"pay_invoice",params:{invoice:n}})),s={kind:Wr,created_at:Math.round(Date.now()/1e3),content:o,tags:[["p",e]]};return oe(s,t)}var ll={};q(ll,{normalizeIdentifier:()=>ul});function ul(e){return e=e.trim().toLowerCase(),e=e.normalize("NFKC"),Array.from(e).map(t=>new RegExp("\\p{Letter}","u").test(t)||new RegExp("\\p{Number}","u").test(t)?t:"-").join("")}var fl={};q(fl,{getZapEndpoint:()=>hl,makeZapReceipt:()=>yl,makeZapRequest:()=>pl,useFetchImplementation:()=>dl,validateZapRequest:()=>gl});var wn;try{wn=fetch}catch{}function dl(e){wn=e}async function hl(e){try{let t="",{lud06:n,lud16:r}=JSON.parse(e.content);if(n){let{words:i}=Ce.decode(n,1e3),c=Ce.fromWords(i);t=ae.decode(c)}else if(r){let[i,c]=r.split("@");t=new URL(`/.well-known/lnurlp/${i}`,`https://${c}`).toString()}else return null;let s=await(await wn(t)).json();if(s.allowsNostr&&s.nostrPubkey)return s.callback}catch{}return null}function pl({profile:e,event:t,amount:n,relays:r,comment:o=""}){if(!n)throw new Error("amount not given");if(!e)throw new Error("profile not given");let s={kind:9734,created_at:Math.round(Date.now()/1e3),content:o,tags:[["p",e],["amount",n.toString()],["relays",...r]]};if(t&&typeof t=="string"&&s.tags.push(["e",t]),t&&typeof t=="object"){if(en(t.kind)){const i=["a",`${t.kind}:${t.pubkey}:`];s.tags.push(i)}else if(lt(t.kind)){let i=t.tags.find(([a,u])=>a==="d"&&u);if(!i)throw new Error("d tag not found or is empty");const c=["a",`${t.kind}:${t.pubkey}:${i[1]}`];s.tags.push(c)}}return s}function gl(e){let t;try{t=JSON.parse(e)}catch{return"Invalid zap request JSON."}if(!Yt(t))return"Zap request is not a valid Nostr event.";if(!ct(t))return"Invalid signature on zap request.";let n=t.tags.find(([s,i])=>s==="p"&&i);if(!n)return"Zap request doesn't have a 'p' tag.";if(!n[1].match(/^[a-f0-9]{64}$/))return"Zap request 'p' tag is not valid hex.";let r=t.tags.find(([s,i])=>s==="e"&&i);return r&&!r[1].match(/^[a-f0-9]{64}$/)?"Zap request 'e' tag is not valid hex.":t.tags.find(([s,i])=>s==="relays"&&i)?null:"Zap request doesn't have a 'relays' tag."}function yl({zapRequest:e,preimage:t,bolt11:n,paidAt:r}){let o=JSON.parse(e),s=o.tags.filter(([c])=>c==="e"||c==="p"||c==="a"),i={kind:9735,created_at:Math.round(r.getTime()/1e3),content:"",tags:[...s,["P",o.pubkey],["bolt11",n],["description",e]]};return t&&i.tags.push(["preimage",t]),i}var wl={};q(wl,{getToken:()=>bl,hashPayload:()=>bn,unpackEventFromToken:()=>wo,validateEvent:()=>Ao,validateEventKind:()=>Eo,validateEventMethodTag:()=>mo,validateEventPayloadTag:()=>xo,validateEventTimestamp:()=>bo,validateEventUrlTag:()=>vo,validateToken:()=>El});var yo="Nostr ";async function bl(e,t,n,r=!1,o){const s={kind:on,tags:[["u",e],["method",t]],created_at:Math.round(new Date().getTime()/1e3),content:""};o&&s.tags.push(["payload",bn(o)]);const i=await n(s);return(r?yo:"")+ce.encode(Q.encode(JSON.stringify(i)))}async function El(e,t,n){const r=await wo(e).catch(s=>{throw s});return await Ao(r,t,n).catch(s=>{throw s})}async function wo(e){if(!e)throw new Error("Missing token");e=e.replace(yo,"");const t=ae.decode(ce.decode(e));if(!t||t.length===0||!t.startsWith("{"))throw new Error("Invalid token");return JSON.parse(t)}function bo(e){return e.created_at?Math.round(new Date().getTime()/1e3)-e.created_at<60:!1}function Eo(e){return e.kind===on}function vo(e,t){const n=e.tags.find(r=>r[0]==="u");return n?n.length>0&&n[1]===t:!1}function mo(e,t){const n=e.tags.find(r=>r[0]==="method");return n?n.length>0&&n[1].toLowerCase()===t.toLowerCase():!1}function bn(e){const t=Pe(Q.encode(JSON.stringify(e)));return Z(t)}function xo(e,t){const n=e.tags.find(o=>o[0]==="payload");if(!n)return!1;const r=bn(t);return n.length>0&&n[1]===r}async function Ao(e,t,n,r){if(!ct(e))throw new Error("Invalid nostr event, signature invalid");if(!Eo(e))throw new Error("Invalid nostr event, kind invalid");if(!bo(e))throw new Error("Invalid nostr event, created_at timestamp invalid");if(!vo(e,t))throw new Error("Invalid nostr event, url tag invalid");if(!mo(e,n))throw new Error("Invalid nostr event, method tag invalid");if(r&&typeof r=="object"&&Object.keys(r).length>0&&!xo(e,r))throw new Error("Invalid nostr event, payload tag does not match request body hash");return!0}const En=new Ya;let gt=[];gt=["wss://relay.damus.io","wss://nostr.mom/","wss://relay.nostr.band","wss://relay.8333.space","wss://nostr-pub.wellorder.net","wss://nostr.oxtr.dev","wss://nos.lol"];function Ll(e){return En.querySync(gt,e)}function kl(e){return En.get(gt,e)}function Rl(e){return En.publish(gt,e)}export{kl as g,Xa as n,Rl as p,Ll as q,Al as r,An as s};
